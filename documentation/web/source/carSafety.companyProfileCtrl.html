<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <base href="../">
    <title>JSDoc: source : companyProfileCtrl.js</title>
    <link href="css/prettify-tomorrow.css" type="text/css" rel="stylesheet">
    <link href="css/site.css" type="text/css" rel="stylesheet">
    <link href="css/custom.css" type="text/css" rel="stylesheet">
  </head>
  <body ng-app>
    <nav id="toc">
      <div class="sidenav-search">
      <input placeholder="Filter" id="filter-input" class="col12 block field" type="text">
      </div>
      <div class="nav-wrapper">
      <h2><a href="index.html">Home</a></h2>
      <ul class="module">
        <!-- undefined -->
        <li id="undefined" ng-hide="moduleundefined">
          <ul class="group">
            <h2 class="nav-group">
              <a href ng-click="undefinedModule = !undefinedModule">
                Module
              </a>
              <i ng-cloak ng-show="undefinedModule">+</i>
            </h2>
            <ul ng-hide="undefinedModule">
              <li>
                <a href="carSafety.html">carSafety</a>
              </li>
            </ul>
          </ul>
        </li>
      </ul><ul class="module">
        <!-- car_afety -->
        <h2 class="module">
          <a chref ng-click="modulecar_afety = !modulecar_afety">
            module: carSafety
          </a>
          <i ng-cloak ng-show="modulecar_afety">+</i>
        </h2>
        <li id="carSafety" ng-hide="modulecar_afety">
          <ul class="group">
            <h2 class="nav-group">
              <a href ng-click="car_afetyController = !car_afetyController">
                Controller
              </a>
              <i ng-cloak ng-show="car_afetyController">+</i>
            </h2>
            <ul ng-hide="car_afetyController">
              <li>
                <a href="carSafety.adminpanelloginCtrl.html">adminpanelloginCtrl</a>
              </li><li>
                <a href="carSafety.adminpanelnavCtrl.html">adminpanelnavCtrl</a>
              </li><li>
                <a href="carSafety.apcompanyaddCtrl.html">apcompanyaddCtrl</a>
              </li><li>
                <a href="carSafety.apcompanyeditCtrl.html">apcompanyeditCtrl</a>
              </li><li>
                <a href="carSafety.apcompanylistCtrl.html">apcompanylistCtrl</a>
              </li><li>
                <a href="carSafety.apdeviceaddCtrl.html">apdeviceaddCtrl</a>
              </li><li>
                <a href="carSafety.apdeviceeditCtrl.html">apdeviceeditCtrl</a>
              </li><li>
                <a href="carSafety.apdevicelistCtrl.html">apdevicelistCtrl</a>
              </li><li>
                <a href="carSafety.apdrvcardaddCtrl.html">apdrvcardaddCtrl</a>
              </li><li>
                <a href="carSafety.apdrvcardlogCtrl.html">apdrvcardlogCtrl</a>
              </li><li>
                <a href="carSafety.apmailnotifyaddCtrl.html">apmailnotifyaddCtrl</a>
              </li><li>
                <a href="carSafety.apmailnotifyeditCtrl.html">apmailnotifyeditCtrl</a>
              </li><li>
                <a href="carSafety.apmailnotifylistCtrl.html">apmailnotifylistCtrl</a>
              </li><li>
                <a href="carSafety.autologinCtrl.html">autologinCtrl</a>
              </li><li>
                <a href="carSafety.companyProfileCtrl.html">companyProfileCtrl</a>
              </li><li>
                <a href="carSafety.404Ctrl.html">404Ctrl</a>
              </li><li>
                <a href="carSafety.dashCtrl.html">dashCtrl</a>
              </li><li>
                <a href="carSafety.deviceSetCtrl.html">deviceSetCtrl</a>
              </li><li>
                <a href="carSafety.drivergrpProfileCtrl.html">drivergrpProfileCtrl</a>
              </li><li>
                <a href="carSafety.drivergrpSetCtrl.html">drivergrpSetCtrl</a>
              </li><li>
                <a href="carSafety.driverProfileCtrl.html">driverProfileCtrl</a>
              </li><li>
                <a href="carSafety.driverSetCtrl.html">driverSetCtrl</a>
              </li><li>
                <a href="carSafety.forgetPwdCtrl.html">forgetPwdCtrl</a>
              </li><li>
                <a href="carSafety.helpCtrl.html">helpCtrl</a>
              </li><li>
                <a href="carSafety.liveLocationCtrl.html">liveLocationCtrl</a>
              </li><li>
                <a href="carSafety.liveMonitorCtrl.html">liveMonitorCtrl</a>
              </li><li>
                <a href="carSafety.loginCtrl.html">loginCtrl</a>
              </li><li>
                <a href="carSafety.mailNotifySetCtrl.html">mailNotifySetCtrl</a>
              </li><li>
                <a href="carSafety.orgchartSetCtrl.html">orgchartSetCtrl</a>
              </li><li>
                <a href="carSafety.resetPwdCtrl.html">resetPwdCtrl</a>
              </li><li>
                <a href="carSafety.rosterSetCtrl.html">rosterSetCtrl</a>
              </li><li>
                <a href="carSafety.tripDetailCtrl.html">tripDetailCtrl</a>
              </li><li>
                <a href="carSafety.tripDrvImportCtrl.html">tripDrvImportCtrl</a>
              </li><li>
                <a href="carSafety.tripSetCtrl.html">tripSetCtrl</a>
              </li><li>
                <a href="carSafety.updatePwdCtrl.html">updatePwdCtrl</a>
              </li><li>
                <a href="carSafety.userroleSetCtrl.html">userroleSetCtrl</a>
              </li><li>
                <a href="carSafety.userSetCtrl.html">userSetCtrl</a>
              </li><li>
                <a href="carSafety.vehiclegrpProfileCtrl.html">vehiclegrpProfileCtrl</a>
              </li><li>
                <a href="carSafety.vehiclegrpSetCtrl.html">vehiclegrpSetCtrl</a>
              </li><li>
                <a href="carSafety.vehicleProfileCtrl.html">vehicleProfileCtrl</a>
              </li><li>
                <a href="carSafety.vehicleSetCtrl.html">vehicleSetCtrl</a>
              </li><li>
                <a href="carSafety.warnExportCtrl.html">warnExportCtrl</a>
              </li><li>
                <a href="carSafety.warnvideoDownloadCtrl.html">warnvideoDownloadCtrl</a>
              </li>
            </ul>
          </ul><ul class="group">
            <h2 class="nav-group">
              <a href ng-click="car_afetyService = !car_afetyService">
                Service
              </a>
              <i ng-cloak ng-show="car_afetyService">+</i>
            </h2>
            <ul ng-hide="car_afetyService">
              <li>
                <a href="carSafety.alertBox.html">alertBox</a>
              </li><li>
                <a href="carSafety.formValidService.html">formValidService</a>
              </li><li>
                <a href="carSafety.httpSuccessCheck.html">httpSuccessCheck</a>
              </li><li>
                <a href="carSafety.langService.html">langService</a>
              </li><li>
                <a href="carSafety.profileService.html">profileService</a>
              </li><li>
                <a href="carSafety.refetchMapService.html">refetchMapService</a>
              </li><li>
                <a href="carSafety.responsiveCheck.html">responsiveCheck</a>
              </li>
            </ul>
          </ul><ul class="group">
            <h2 class="nav-group">
              <a href ng-click="car_afetyConfig = !car_afetyConfig">
                Config
              </a>
              <i ng-cloak ng-show="car_afetyConfig">+</i>
            </h2>
            <ul ng-hide="car_afetyConfig">
              <li>
                <a href="carSafety.angular-chart-js.html">angular-chart-js</a>
              </li><li>
                <a href="carSafety.angular-dynamic-locale.html">angular-dynamic-locale</a>
              </li><li>
                <a href="carSafety.angular-translate.html">angular-translate</a>
              </li><li>
                <a href="carSafety.angularjs.html">angularjs</a>
              </li><li>
                <a href="carSafety.angularjs-material.html">angularjs-material</a>
              </li><li>
                <a href="carSafety.block-ui.html">block-ui</a>
              </li><li>
                <a href="carSafety.ng-idle.html">ng-idle</a>
              </li><li>
                <a href="carSafety.state-transition.html">state-transition</a>
              </li><li>
                <a href="carSafety.ui-router.html">ui-router</a>
              </li>
            </ul>
          </ul><ul class="group">
            <h2 class="nav-group">
              <a href ng-click="car_afetyConstant = !car_afetyConstant">
                Constant
              </a>
              <i ng-cloak ng-show="car_afetyConstant">+</i>
            </h2>
            <ul ng-hide="car_afetyConstant">
              <li>
                <a href="carSafety.appConfig.html">appConfig</a>
              </li><li>
                <a href="carSafety.chartConfig.html">chartConfig</a>
              </li><li>
                <a href="carSafety.errorCodeConfig.html">errorCodeConfig</a>
              </li><li>
                <a href="carSafety.exportConfig.html">exportConfig</a>
              </li><li>
                <a href="carSafety.mapConfig.html">mapConfig</a>
              </li><li>
                <a href="carSafety.regexConfig.html">regexConfig</a>
              </li>
            </ul>
          </ul><ul class="group">
            <h2 class="nav-group">
              <a href ng-click="car_afetyDirective = !car_afetyDirective">
                Directive
              </a>
              <i ng-cloak ng-show="car_afetyDirective">+</i>
            </h2>
            <ul ng-hide="car_afetyDirective">
              <li>
                <a href="carSafety.bInfoWindow.html">bInfoWindow</a>
              </li><li>
                <a href="carSafety.bMarker.html">bMarker</a>
              </li><li>
                <a href="carSafety.bPolyline.html">bPolyline</a>
              </li><li>
                <a href="carSafety.bTrafficLayer.html">bTrafficLayer</a>
              </li><li>
                <a href="carSafety.convertToNumber.html">convertToNumber</a>
              </li><li>
                <a href="carSafety.customOnChange.html">customOnChange</a>
              </li><li>
                <a href="carSafety.fileInputImg.html">fileInputImg</a>
              </li><li>
                <a href="carSafety.multicheckListbox.html">multicheckListbox</a>
              </li><li>
                <a href="carSafety.navbar.html">navbar</a>
              </li><li>
                <a href="carSafety.pageSelect.html">pageSelect</a>
              </li><li>
                <a href="carSafety.showTooltipOnTextOverflow.html">showTooltipOnTextOverflow</a>
              </li><li>
                <a href="carSafety.stFiltered.html">stFiltered</a>
              </li><li>
                <a href="carSafety.stPersist.html">stPersist</a>
              </li><li>
                <a href="carSafety.stSelectDistinct.html">stSelectDistinct</a>
              </li><li>
                <a href="carSafety.virtualResize.html">virtualResize</a>
              </li>
            </ul>
          </ul><ul class="group">
            <h2 class="nav-group">
              <a href ng-click="car_afetyFilter = !car_afetyFilter">
                Filter
              </a>
              <i ng-cloak ng-show="car_afetyFilter">+</i>
            </h2>
            <ul ng-hide="car_afetyFilter">
              <li>
                <a href="carSafety.fixNum.html">fixNum</a>
              </li><li>
                <a href="carSafety.optionalFilter.html">optionalFilter</a>
              </li><li>
                <a href="carSafety.tableCustomFilter.html">tableCustomFilter</a>
              </li>
            </ul>
          </ul><ul class="group">
            <h2 class="nav-group">
              <a href ng-click="car_afetyRun = !car_afetyRun">
                Run
              </a>
              <i ng-cloak ng-show="car_afetyRun">+</i>
            </h2>
            <ul ng-hide="car_afetyRun">
              <li>
                <a href="carSafety.state-transition-init.html">state-transition-init</a>
              </li>
            </ul>
          </ul>
        </li>
      </ul>
      </div>
    </nav>
    <div id="content" class="page-wrap">
      <h1 class="title">
        source : companyProfileCtrl.js
      </h1>
      <div id="main" class="big-container">
        <!-- source code html -->
        <article>
          <pre class="prettyprint source linenums"><code>/*
* @Author: Zilvia Kam
* @Date:   2019-04-04 17:39:29
* @Last Modified by:   Zilvia Kam
* @Last Modified time: 2019-10-08 11:22:12
*/
/**
 * @memberof carSafety
 * @ngdoc Controller
 * @name companyProfileCtrl
 * @requires $scope,$state,$stateParams,$http,blockUI,$timeout,$translate,user,Idle,Keepalive,httpSuccessCheck,alertBox,$window,$filter,appConfig, profileService,tmhDynamicLocale,refetchMapService,$mdDialog,exportConfig,chartConfig,mapConfig
 * @description
 *   Controller for company profile page.
 */
angular.module('carSafety').controller("companyProfileCtrl", ["$scope", "$state", "$stateParams", "$http", "blockUI", "$timeout", "$translate", "user", "Idle", "Keepalive", "httpSuccessCheck", "alertBox", "$window", "$filter", "appConfig", "profileService", "tmhDynamicLocale", "refetchMapService", "$mdDialog", "exportConfig", "chartConfig", "mapConfig", function ($scope, $state, $stateParams, $http, blockUI, $timeout, $translate, user, Idle, Keepalive, httpSuccessCheck, alertBox, $window, $filter, appConfig, profileService, tmhDynamicLocale, refetchMapService, $mdDialog, exportConfig, chartConfig, mapConfig) {
	Idle.watch();
	var blockUi = angular.element(document.getElementsByTagName("BODY")[0]);
	blockUi.addClass('block-ui-active block-ui-visible')
	/*$scope.setTitle = function(){
		window.setTimeout(function(){
			window.document.title = $translate.instant('comProfile');
		}, 50);
	}*/
	/**
	 * @memberOf companyProfileCtrl
	 * @member $scope
	 * @property {String} permission permission
	 * @property {Object} userInfo user info object
	 * @property {String} companyName company name
	 */
	$scope.permission = user.func_code;
	$scope.userInfo = user;
	$scope.companyName = $scope.userInfo.company_name
	$scope.lang = $scope.userInfo.lang;
/*	$scope.periodselected = 'd'
	$scope.period = 'd'*/
	$scope.periodselected = 'm'
	$scope.period = 'm'
	$scope.dateSelected = {
		opened: false
	}
	$scope.drvDistance = 20
	$scope.distanceselected = 20
	var newdatetmp = $filter('date')(new Date(new Date().setDate(new Date().getDate() - 1)), 'MM/dd/yyyy HH:mm:ss', $scope.userInfo.timezone);
	$scope.maxDate = new Date(newdatetmp)
	$scope.minDate = new Date('01/01/1990 00:00:00')
/*	$scope.dateselected = new Date(new Date(newdatetmp).setHours(0, 0, 0, 0));
	$scope.dateSelectOptions = {
		maxDate: $scope.maxDate,
		minDate: $scope.minDate,
		startingDay: 1,
		showWeeks: false,
		formatMonth: 'MMM',
		yearColumns: 3
	};*/
	$scope.dateselected = new Date(new Date(new Date(newdatetmp).setDate(1)).setHours(0, 0, 0, 0))
	$scope.dateSelectOptions = {
		maxDate: $scope.maxDate,
		minDate: $scope.minDate,
		minMode: 'month',
		startingDay: 1,
		showWeeks: false,
		formatMonth: 'MMM',
		yearColumns: 3
	};
	/*$rootScope.$on('$translateChangeSuccess', function() {
       	tmhDynamicLocale.set($scope.lang);
        window.document.title = $translate.instant('comProfile');
 	});*/
	//$translate.use($scope.lang);
	//$scope.setTitle();
	window.document.title = $translate.instant('comProfile');
	tmhDynamicLocale.set($scope.lang);
	$scope.itemsByPage = 10;
	$scope.itemsByPageFull = 25;
	$scope.displayPage = 5;
	$scope.gaugeColor = chartConfig.gaugeColor
	$scope.scoreTagFieldList = chartConfig.scoreTagFieldSet
	$scope.dataFieldSet = chartConfig.dataFieldSet
	$scope.warnFieldArr = []
	$scope.spiderLabelRaw = []
	$scope.spiderLabel = []
	$scope.scoreChartSeriesDDB = []
	$scope.scoreChartSeriesBDB = []
	$scope.scoreChartSeriesComfort = []
	for (var i = 0; i &lt; chartConfig.spiderFieldSet.length; i++){
		for (var j = 0; j &lt; chartConfig.spiderFieldSet[i].length; j++) {
		  	$scope.spiderLabelRaw.push(chartConfig.spiderFieldSet[i][j]);
		}
	}
	for (var i = 0; i &lt; $scope.dataFieldSet.length; i++){
		for (var j = 0; j &lt; $scope.dataFieldSet[i].length; j++) {
			$scope.warnFieldArr.push($scope.dataFieldSet[i][j])
		}
	}
	//window.setTimeout(function(){
	$translate($scope.spiderLabelRaw).then(function (translations) {
		angular.forEach(translations, function (value, key) {
			$scope.spiderLabel.push(value);
		});
	}, function (translationIds) {
		angular.forEach(translations, function (value, key) {
			$scope.spiderLabel.push(value);
		});
	});
	$translate($scope.dataFieldSet[0]).then(function (translations) {
		angular.forEach(translations, function (value, key) {
			$scope.scoreChartSeriesDDB.push(value);
		});
	}, function (translationIds) {
		angular.forEach(translations, function (value, key) {
			$scope.scoreChartSeriesDDB.push(value);
		});
	});
	$translate($scope.dataFieldSet[1]).then(function (translations) {
		angular.forEach(translations, function (value, key) {
			$scope.scoreChartSeriesBDB.push(value);
		});
	}, function (translationIds) {
		angular.forEach(translations, function (value, key) {
			$scope.scoreChartSeriesBDB.push(value);
		});
	});
	$translate($scope.dataFieldSet[2]).then(function (translations) {
		angular.forEach(translations, function (value, key) {
			$scope.scoreChartSeriesComfort.push(value);
		});
	}, function (translationIds) {
		angular.forEach(translations, function (value, key) {
			$scope.scoreChartSeriesComfort.push(value);
		});
	});
	//}, 100);
	$scope.profileExcelOrderDate = exportConfig.profileExcelOrderDate.concat($scope.warnFieldArr)
	$scope.profileExcelOrderName = exportConfig.profileExcelOrderName.concat($scope.warnFieldArr)
	$scope.profileExcelOrderDateAct = exportConfig.profileExcelOrderDateAct.concat($scope.warnFieldArr)
	$scope.profileExcelOrderNameAct = exportConfig.profileExcelOrderNameAct.concat($scope.warnFieldArr)
	$scope.profileExcelOrderDateScore = exportConfig.profileExcelOrderDateScore.concat($scope.warnFieldArr)
	$scope.profileExcelOrderNameScore = exportConfig.profileExcelOrderNameScore.concat($scope.warnFieldArr)
	$scope.profileExcelOrderRank = exportConfig.profileExcelOrderNameRank.concat($scope.warnFieldArr)
	$scope.profileExcelOrderVideoDep = exportConfig.profileExcelOrderVideoDep
	$scope.warnSpecExcelOrder = exportConfig.warnSpecExcelOrder
	$scope.getcsvHeader = function (table) {
		var headerArr = []
		if (table !== 'video' && table !== 'warnSpec') {
			switch (table) {
				case 'company':
				case 'companyAct':
					headerArr.push($translate.instant('startDate'))
					break;
				case 'drvgrp':
				case 'drvgrpAct':
					headerArr.push($translate.instant('group'))
					headerArr.push($translate.instant('department'))
					break;
				case 'driver':
				case 'driverAct':
					headerArr.push($translate.instant('name'))
					headerArr.push($translate.instant('department'))
					break;
				case 'vehgrp':
				case 'vehgrpAct':
					headerArr.push($translate.instant('group'))
					headerArr.push($translate.instant('department'))
					break;
				case 'vehicle':
				case 'vehicleAct':
					headerArr.push($translate.instant('licence'))
					headerArr.push($translate.instant('department'))
					break;
				case 'drvRank':
					headerArr.push($translate.instant('name'))
					headerArr.push($translate.instant('department'))
					break;
				case 'vehRank':
					headerArr.push($translate.instant('licence'))
					headerArr.push($translate.instant('department'))
					break;
			}
			if (!table.includes('Rank')) {
				headerArr.push($translate.instant('totalScore'))
			} else {
				headerArr.push($translate.instant('totalRank'))
			}
			headerArr.push($translate.instant('distance') + '(' + $translate.instant('km') + ')')
			for (var i = 0; i &lt; $scope.warnFieldArr.length; i++){
				headerArr.push($translate.instant($scope.warnFieldArr[i]))
			}
		}
		else if (table == 'video') {
			headerArr.push($translate.instant('video')+' ID')
			headerArr.push($translate.instant('lat') + ' (WGS84)')
			headerArr.push($translate.instant('lng') + ' (WGS84)')
			headerArr.push($translate.instant('warnType'))
			headerArr.push($translate.instant('startTime'))
			headerArr.push($translate.instant('vehicle'))
			headerArr.push($translate.instant('vehDept'))
			headerArr.push($translate.instant('driver'))
			headerArr.push($translate.instant('drvDept'))
			headerArr.push($translate.instant('roc'))
			headerArr.push($translate.instant('duration') + ' (s)')
			headerArr.push($translate.instant('startSpeed') + ' (kph)')
			headerArr.push($translate.instant('endSpeed') + ' (kph)')
			headerArr.push($translate.instant('topSpeed') + ' (kph)')
			headerArr.push($translate.instant('HW') + ' (s)')
			headerArr.push($translate.instant('nearHW') + ' (s)')
		}
		else {
			headerArr.push($translate.instant('video')+' ID')
			headerArr.push($translate.instant('lat') + ' (WGS84)')
			headerArr.push($translate.instant('lng') + ' (WGS84)')
			headerArr.push($translate.instant('startTime'))
			headerArr.push($translate.instant('vehicle'))
			headerArr.push($translate.instant('vehDept'))
			headerArr.push($translate.instant('driver'))
			headerArr.push($translate.instant('drvDept'))
			headerArr.push($translate.instant('duration') + ' (s)')
			headerArr.push($translate.instant('startSpeed') + ' (kph)')
			headerArr.push($translate.instant('endSpeed') + ' (kph)')
			headerArr.push($translate.instant('topSpeed') + ' (kph)')
			headerArr.push($translate.instant('HW') + ' (s)')
			headerArr.push($translate.instant('nearHW') + ' (s)')
		}
		return headerArr
	}
	$scope.getcsvData = function (data, table) {
		var csvdata = angular.copy(data)
		if (table == 'warnSpec') {
			angular.forEach(csvdata, function (value, key) {
				if (value.videoReady !== 'Y') {
					value.video = null
				}
				if($scope.verifyGPS(value.rawgps)){
					value.lat = value.rawgps[0]
					value.lng = value.rawgps[1]
				}
				else{
					value.lat = null
					value.lng = null
				}
				if(value.hw===null){
					value.hw = $translate.instant('NA')
				}
				if(value.near_hw===null){
					value.near_hw = $translate.instant('NA')
				}
			})
		} else if (table == 'video') {
			angular.forEach(csvdata, function (value, key) {
				if (value.videoReady !== 'Y') {
					value.video = null
				}
				if($scope.verifyGPS(value.rawgps)){
					value.lat = value.rawgps[0]
					value.lng = value.rawgps[1]
				}
				else{
					value.lat = null
					value.lng = null
				}
				if(value.hw===null){
					value.hw = $translate.instant('NA')
				}
				if(value.near_hw===null){
					value.near_hw = $translate.instant('NA')
				}
				value.warningType = $translate.instant(value.warningType)
			})
		}
		return csvdata
	}
	$scope.isNull = function(data){
	    return data===null;
	}
	$scope.verifyGPS = function(gps){
    	if(!gps.includes(0)&&!gps.includes(null)){
    		return true
    	}
    	else{
    		return false
    	}
    }
    $scope.checkWarnLocation = function(row,warnType){
    	var staticmap
    	var icon
    	if(window.location.href.split(window.location.pathname)[0]==appConfig.devEnv){
    		icon = appConfig.prdEnv
    	}
    	else{
    		icon = window.location.href.split(window.location.pathname)[0]
    	}
    	icon += "/images/"+warnType+".png"
    	if($scope.userInfo.map=='googleMap'){
    		staticmap = mapConfig.googlestaticmap+"&markers=icon:"+icon+"|"+row.gps[0]+","+row.gps[1]+"&"+mapConfig.googlemapKey
    	}
    	else{
    		//staticmap = mapConfig.baidustaticmap+"&markers="+row.gps[0]+","+row.gps[1]+"&markerStyles=-1,"+icon+",-1&"+mapConfig.baidumapKey
    		staticmap = mapConfig.baidustaticmap+"&markers="+row.gps[0]+","+row.gps[1]+"&"+mapConfig.baidumapKey
    	}
    	var text = $translate.instant('lat')+":"+row.rawgps[0]+", "+$translate.instant('lng')+":"+row.rawgps[1]
    	alertBox.GPSLocationAlert(staticmap, text);
    }
	$scope.checkDistance = function (event) {
		//var keyCode = ('which' in event) ? event.which : event.keyCode;
		//var isNumeric = (keyCode >= 48 /* KeyboardEvent.DOM_VK_0 */ && keyCode &lt;= 57 /* KeyboardEvent.DOM_VK_9 */ ) || (keyCode >= 96 /* KeyboardEvent.DOM_VK_NUMPAD0 */ && keyCode &lt;= 105 /* KeyboardEvent.DOM_VK_NUMPAD9 */ );
		/*var modifiers = (event.altKey || event.ctrlKey || event.shiftKey || keyCode == 8);*/
		//var decimals = (keyCode == 110 || keyCode == 190);
		/*var inputvalue = event.target.value*/
		//var decimalpos = inputvalue.indexOf(".");
		/*var result*/
		/*if (decimalpos !== -1) {
			if (inputvalue.length - 1 == decimalpos) {
				result = isNumeric || modifiers;
			} else {
				result = false || modifiers;
			}
		} else {
			result = isNumeric || modifiers || decimals;
		}*/
		/*result = isNumeric || modifiers;
		if (!result) {
			event.preventDefault()
		}*/
		var keyCode = ('which' in event) ? event.which : event.keyCode;
		var isNumeric = (keyCode >= 48 /* KeyboardEvent.DOM_VK_0 */ && keyCode &lt;= 57 /* KeyboardEvent.DOM_VK_9 */) || (keyCode >= 96 /* KeyboardEvent.DOM_VK_NUMPAD0 */ && keyCode &lt;= 105 /* KeyboardEvent.DOM_VK_NUMPAD9 */);
        var modifiers = (event.altKey || event.ctrlKey || event.shiftKey || keyCode==8);
        var decimals = (keyCode==110 || keyCode==190);
        var inputvalue = event.target.value
        var decimalpos = inputvalue.indexOf(".");
        var result
        if (decimalpos !== -1) {
            if(inputvalue.length-1 == decimalpos){
            	result = isNumeric || modifiers;
            }
           	else{
          		result = false || modifiers;
          	}
        }
        else{
        	result = isNumeric || modifiers || decimals;
        }
        if (!result){
        	event.preventDefault()
        }
	}
	$scope.changeDistance = function (distance){
		$scope.drvDistance = distance
	}
	$scope.spiderOption = {
		scale: {
			ticks: {
				beginAtZero: false,
				min: -5,
				max: 100,
				stepSize: 10,
				userCallback: function (value, index, values) {
					return chartConfig.spiderAsix[value];
				}
			}
		},
		tooltips: {
			mode: 'single',
			callbacks: {
				title: function (tooltipItem, data) {
					var titleval
					if (tooltipItem[0].yLabel == -5) {
						titleval = undefined
					} else if (tooltipItem[0].datasetIndex == 0 && tooltipItem[0].yLabel == -5 && tooltipItem[0].index == chartConfig.spiderFieldSet[0].length) {
						titleval = undefined
					} else if (tooltipItem[0].datasetIndex == 0 && isNaN(tooltipItem[0].yLabel) && tooltipItem[0].index == 0) {
						titleval = undefined
					} else {
						titleval = data.labels[tooltipItem[0].index];
					}
					return titleval
				},
				label: function (tooltipItem, data) {
					var labelval
					if (tooltipItem.datasetIndex == 0 && (tooltipItem.index >= 0 && tooltipItem.index &lt;= chartConfig.spiderFieldSet[0].length-1)) {
						labelval = tooltipItem.yLabel;
					} else if (tooltipItem.datasetIndex == 1 && (tooltipItem.index >= chartConfig.spiderFieldSet[0].length && tooltipItem.index &lt;= chartConfig.spiderFieldSet[0].length+chartConfig.spiderFieldSet[1].length-1)) {
						labelval = tooltipItem.yLabel;
					} else if (tooltipItem.datasetIndex == 2 && (tooltipItem.index >= chartConfig.spiderFieldSet[0].length+chartConfig.spiderFieldSet[1].length && tooltipItem.index &lt;= chartConfig.spiderFieldSet[0].length+chartConfig.spiderFieldSet[1].length+chartConfig.spiderFieldSet[2].length-1)) {
						labelval = tooltipItem.yLabel;
					}
					else{
						labelval = undefined
					}
					if(labelval==0){
						return '0';
					}
					else{
						return labelval;
					}
				}
			}
		}
	}
	$scope.getSpiderPoint = function(){
		var radius = []
		if($scope.recentRecord&&$scope.recentRecord.spiderset){
			for (var i = 0; i &lt; $scope.recentRecord.spiderset.length; i++) {
				var arr = []
				var arr2 = []
				var arr3 = []
				for(var j = 0; j&lt;  $scope.recentRecord.spiderset[i].length; j++){
					if($scope.recentRecord.spiderset[i][j]==-5){
						arr.push(0)
						arr2.push(0)
						arr3.push(0)
					}
					else{
						arr.push(3)
						arr2.push(4)
						arr3.push(1)
					}
				}
				var override = {
					pointRadius: arr,
					pointHoverRadius: arr2,
					pointHitRadius: arr3,
					pointBorderWidth: arr3,
					pointHoverBorderWidth: arr3
				}
				radius.push(override)
			}
		}
		else{
			radius = undefined
		}
		return radius
	}
	$scope.spiderHover = function (points, evt, item) {
		if (points.length !== 0 && !(item._datasetIndex == 0 && item._index == chartConfig.spiderFieldSet[0].length) && !(item._datasetIndex == 0 && ($scope.recentRecord.spiderset[0][item._index] == -5 || $scope.recentRecord.spiderset[0][item._index] == null))) {
			angular.element(evt.target)[0].style.cursor = "pointer";
		}else {
			angular.element(evt.target)[0].style.removeProperty('cursor');
		}
		$scope.spiderPoint = $scope.getSpiderPoint();
		$scope.$apply();
	}
	$scope.spiderChartFullScreen = false;
	var displayColWatcherFunc = function (newValue, oldValue) {
		$timeout(function () {
			var tablewrap = document.getElementsByClassName('warn-table-fullscreen')[0]
			if(tablewrap){
				var table = tablewrap.getElementsByTagName('table')[0]
				if(table){
					var scrollY = tablewrap.scrollTop
					var scrollX = tablewrap.scrollLeft
					if (scrollY && scrollY > 0 && tablewrap.scrollTop &lt;= table.children[1].clientHeight) {
						var firstRow = table.children[1].children[0]
						if(firstRow && firstRow.children.length>1){
							var trh = table.children[0].children[0]
							var th = table.children[0]
							var colength = firstRow.children.length&lt;=trh.children.length?firstRow.children.length:trh.children.length
							for (var j = 0; j &lt; colength; j++) {
								firstRow.children[j].removeAttribute("style")
								trh.children[j].removeAttribute("style")
							}
							/*for (var j = 0; j &lt; trh.children.length; j++) {
								firstRow.children[j].removeAttribute("style")
								trh.children[j].removeAttribute("style")
							}*/
							table.children[0].classList.remove('table-stickyheader')
							table.children[0].style.removeProperty('top')
							table.children[0].style.removeProperty('position')
							table.children[0].style.removeProperty('overflow')
							table.children[0].style.removeProperty('width')
							tablewrap.style.overflow = 'hidden'
							$scope.$apply()
							$timeout(function () {
								tablewrap.style.removeProperty('overflow')
								var cellwidth = []
								for (var i = 0; i &lt; trh.children.length; i++) {
									var cellbody = firstRow.children[i]
									var cell = trh.children[i]
									var setWidth = cell.clientWidth > cellbody.clientWidth ? cell.clientWidth : cellbody.clientWidth
									cellwidth.push(setWidth)
								}
								for (var i = 0; i &lt; cellwidth.length; i++) {
									firstRow.children[i].style.width = cellwidth[i] + 'px'
									trh.children[i].style.width = cellwidth[i] + 'px'
									firstRow.children[i].style.minWidth = cellwidth[i] + 'px'
									trh.children[i].style.minWidth = cellwidth[i] + 'px'
								}
								table.children[0].classList.add('table-stickyheader')
								table.children[0].style.top = '36px'
								table.children[0].style.position = 'absolute'
								table.children[0].style.overflow = 'hidden'
								var scrollbarWidth = tablewrap.offsetWidth - tablewrap.clientWidth
								table.children[0].style.width = 'calc( 100% - ' + scrollbarWidth + 'px )'
								if (scrollX > 0) {
									table.children[0].scrollLeft = tablewrap.scrollLeft
								} else {
									var scrollbarWidth = tablewrap.offsetWidth - tablewrap.clientWidth
									table.children[0].scrollLeft = '-' + scrollbarWidth + 'px'
								}
							}, true)
						}
					}
				}
			}
		})
	}
	$scope.toggleWarnspecVideo = function () {
		unwatcher();
		angular.element(document.querySelector('.warn-table-fullscreen')).unbind('scroll')
		scrollvflag = false
		$scope.warnspecVideoFilter = !$scope.warnspecVideoFilter
		/*if ($scope.warnspecVideoFilter) {
			$scope.spiderChartData = $filter('filter')($scope.spiderChartDataOri, {
				'video': '!null',
				'videoReady': 'Y'
			}, true)
		} else {
			$scope.spiderChartData = $scope.spiderChartDataOri
		}*/
		if ($scope.warnspecVideoFilter) {
			if ($scope.warnspecLocationFilter) {
				$scope.spiderChartData = $filter('filter')($scope.spiderChartData, {
					'video': '!null',
					'videoReady': 'Y'
				}, true)
			}
			else{
				$scope.spiderChartData = $filter('filter')($scope.spiderChartDataOri, {
					'video': '!null',
					'videoReady': 'Y'
				}, true)
			}
		}
		else {
			if ($scope.warnspecLocationFilter) {
				$scope.spiderChartData = $filter('filter')($scope.spiderChartDataOri, function (i) {
					return $scope.verifyGPS(i.gps)
				}, true)
			}
			else{
				$scope.spiderChartData = $scope.spiderChartDataOri
			}
		}
		var tablewrap = document.getElementsByClassName('warn-table-fullscreen')[0]
		var table = tablewrap.getElementsByTagName('table')[0]
		var scrollY = tablewrap.scrollTop
		if (scrollY && scrollY > 0) {
			var firstRow = table.children[1].children[0]
			if(firstRow && firstRow.children.length>1){
				var trh = table.children[0].children[0]
				var th = table.children[0]
				var colength = firstRow.children.length&lt;=trh.children.length?firstRow.children.length:trh.children.length
				for (var j = 0; j &lt; colength; j++) {
					firstRow.children[j].removeAttribute("style")
					trh.children[j].removeAttribute("style")
				}
				/*for (var j = 0; j &lt; trh.children.length; j++) {
					firstRow.children[j].removeAttribute("style")
					trh.children[j].removeAttribute("style")
				}*/
				table.children[0].classList.remove('table-stickyheader')
				table.children[0].style.removeProperty('top')
				table.children[0].style.removeProperty('position')
				table.children[0].style.removeProperty('overflow')
				table.children[0].style.removeProperty('width')
			}
		}
		angular.element(document.querySelector('.warn-table-fullscreen'))[0].scrollTop = 0
		angular.element(document.querySelector('.warn-table-fullscreen')).bind('scroll', tablescroll)
		unwatcher = $scope.$watch('displayedCollection', displayColWatcherFunc, true);
	}
	$scope.toggleWarnspecLocation = function () {
		unwatcher();
		angular.element(document.querySelector('.warn-table-fullscreen')).unbind('scroll')
		scrollvflag = false
		$scope.warnspecLocationFilter = !$scope.warnspecLocationFilter
		if ($scope.warnspecLocationFilter) {
			if($scope.warnspecVideoFilter){
				$scope.spiderChartData = $filter('filter')($scope.spiderChartData, function (i) {
					return $scope.verifyGPS(i.gps)
				}, true)
			}
			else{
				$scope.spiderChartData = $filter('filter')($scope.spiderChartDataOri, function (i) {
					return $scope.verifyGPS(i.gps)
				}, true)
			}
		}
		else{
			if($scope.warnspecVideoFilter){
				$scope.spiderChartData = $filter('filter')($scope.spiderChartDataOri, {
					'video': '!null',
					'videoReady': 'Y'
				}, true)
			}
			else{
				$scope.spiderChartData = $scope.spiderChartDataOri
			}
		}
		var tablewrap = document.getElementsByClassName('warn-table-fullscreen')[0]
		var table = tablewrap.getElementsByTagName('table')[0]
		var scrollY = tablewrap.scrollTop
		if (scrollY && scrollY > 0) {
			var firstRow = table.children[1].children[0]
			if(firstRow&&firstRow.children.length>1){
				var trh = table.children[0].children[0]
				var th = table.children[0]
				var colength = firstRow.children.length&lt;=trh.children.length?firstRow.children.length:trh.children.length
				for (var j = 0; j &lt; colength; j++) {
					firstRow.children[j].removeAttribute("style")
					trh.children[j].removeAttribute("style")
				}
				/*for (var j = 0; j &lt; trh.children.length; j++) {
					firstRow.children[j].removeAttribute("style")
					trh.children[j].removeAttribute("style")
				}*/
				table.children[0].classList.remove('table-stickyheader')
				table.children[0].style.removeProperty('top')
				table.children[0].style.removeProperty('position')
				table.children[0].style.removeProperty('overflow')
				table.children[0].style.removeProperty('width')
			}
		}
		angular.element(document.querySelector('.warn-table-fullscreen'))[0].scrollTop = 0
		angular.element(document.querySelector('.warn-table-fullscreen')).bind('scroll', tablescroll)
		unwatcher = $scope.$watch('displayedCollection', displayColWatcherFunc, true);
	}
	$scope.getWarnSpec = function (warn) {
		unwatcher();
		angular.element(document.querySelector('.warn-table-fullscreen')).unbind('scroll')
		scrollvflag = false
		$scope.loadingdata.warnspec = true;
		var range = profileService.getExactDateRange($scope.recentRecord.acc_date, $scope.periodselected)
		var tmp1 = new Date(range.datebf).setHours(0, 0, 0, 0)
		var tmp2 = new Date(range.dateaf).setHours(23, 59, 59, 59)
		var datebf = $filter('date')(tmp1, 'yyyy-MM-dd')
		var dateaf = $filter('date')(tmp2, 'yyyy-MM-dd')
		$http({
			method: 'GET',
			url: '/api/profileQuerySpecWarn/c/' + datebf + '/' + dateaf + '/' + warn
		}).then(function successCallback(response) {
			var errorphp = httpSuccessCheck.checkHttp(response)
			if (errorphp) {
				blockUi.removeClass('block-ui-active block-ui-visible')
				alertBox.errorAlert('91207_01')
			} else {
				var data = response.data.data;
				$scope.spiderChartDataOri = data.map(function (obj) {
					return {
						video: obj.video,
						start_time: obj.start_time,
						vehicle: obj.vehicle,
						vehDepart: obj.vehDepartment,
						driver: obj.driver,
						drvDepart: obj.drvDepartment,
						duration: obj.duration,
						start_spd: obj.start_spd,
						end_spd: obj.end_spd,
						top_spd: obj.top_spd,
						hw: obj.hw,
						near_hw: obj.near_hw,
						vehStatus: obj.vehStatus,
						videoReady: obj.videoReady,
						gps: obj.gps,
						rawgps: obj.rawgps,
						warn_type: obj.warn_type
					}
				})
				/*if ($scope.warnspecVideoFilter) {
					$scope.spiderChartData = $filter('filter')($scope.spiderChartDataOri, {
						'video': '!null',
						'videoReady': 'Y'
					}, true)
				} else {
					$scope.spiderChartData = $scope.spiderChartDataOri
				}*/
				if ($scope.warnspecVideoFilter&&$scope.warnspecLocationFilter) {
					var dataarr = $filter('filter')($scope.spiderChartDataOri, {
						'video': '!null',
						'videoReady': 'Y'
					}, true)
					dataarr = $filter('filter')(dataarr, function (i) {
						return $scope.verifyGPS(i.gps)
					}, true)
					$scope.spiderChartData = dataarr
				}
				else if($scope.warnspecVideoFilter){
					$scope.spiderChartData = $filter('filter')($scope.spiderChartDataOri, {
						'video': '!null',
						'videoReady': 'Y'
					}, true)
				}
				else if($scope.warnspecLocationFilter){
					$scope.spiderChartData = $filter('filter')($scope.spiderChartDataOri, function (i) {
						return $scope.verifyGPS(i.gps)
					}, true)
				}
				else {
					$scope.spiderChartData = $scope.spiderChartDataOri
				}
				blockUi.removeClass('block-ui-active block-ui-visible')
			}
			$scope.loadingdata.warnspec = false;
			$timeout(function () {
				angular.element(document.querySelector('.warn-table-fullscreen')).bind('scroll', tablescroll)
				unwatcher = $scope.$watch('displayedCollection', displayColWatcherFunc, true);
			})
		}, function errorCallback(response) {
			$scope.loadingdata.warnspec = false;
			$timeout(function () {
				angular.element(document.querySelector('.warn-table-fullscreen')).bind('scroll', tablescroll)
				unwatcher = $scope.$watch('displayedCollection', displayColWatcherFunc, true);
			})
			blockUi.removeClass('block-ui-active block-ui-visible')
			var errorphp = httpSuccessCheck.checkerrorHttp(response)
			if (errorphp) {
				alertBox.errorAlert('91207_' + errorphp)
			} else {
				alertBox.errorAlert(response.data.code)
			}
		});
	}
	$scope.preFullScrollX = 0;
	$scope.preFullScrollY = 0;
	$scope.spiderClick = function (points, evt, item) {
		if (points.length !== 0) {
			if (!(item._datasetIndex == 0 && item._index == chartConfig.spiderFieldSet[0].length) && !(item._datasetIndex == 0 && ($scope.recentRecord.spiderset[0][item._index] == -5 || $scope.recentRecord.spiderset[0][item._index] == null))) {
				blockUi.addClass('block-ui-active block-ui-visible')
				var index = points[0]._index;
				var warn = $scope.spiderLabelRaw[index];
				var range = profileService.getExactDateRange($scope.recentRecord.acc_date, $scope.periodselected)
				var tmp1 = new Date(range.datebf).setHours(0, 0, 0, 0)
				var tmp2 = new Date(range.dateaf).setHours(23, 59, 59, 59)
				var datebf = $filter('date')(tmp1, 'yyyy-MM-dd')
				var dateaf = $filter('date')(tmp2, 'yyyy-MM-dd')
				$http({
					method: 'GET',
					url: '/api/profileQuerySpecWarn/c/' + datebf + '/' + dateaf + '/' + warn
				}).then(function successCallback(response) {
					var errorphp = httpSuccessCheck.checkHttp(response)
					if (errorphp) {
						blockUi.removeClass('block-ui-active block-ui-visible')
						alertBox.errorAlert('91207_01')
					} else {
						$scope.preFullScrollX = window.pageXOffset;
						$scope.preFullScrollY = window.pageYOffset;
						$scope.spiderChartFullScreen = true;
						$scope.spiderChartTitle = warn;
						document.getElementsByClassName("pro-wrap")[0].style.height = '100vh';
						document.getElementsByClassName("pro-wrap")[0].style.overflow = 'hidden';
						var data = response.data.data;
						$scope.spiderChartDataOri = data.map(function (obj) {
							return {
								video: obj.video,
								start_time: obj.start_time,
								vehicle: obj.vehicle,
								vehDepart: obj.vehDepartment,
								driver: obj.driver,
								drvDepart: obj.drvDepartment,
								duration: obj.duration,
								start_spd: obj.start_spd,
								end_spd: obj.end_spd,
								top_spd: obj.top_spd,
								hw: obj.hw,
								near_hw: obj.near_hw,
								vehStatus: obj.vehStatus,
								videoReady: obj.videoReady,
								gps: obj.gps,
								rawgps: obj.rawgps,
								warn_type: obj.warn_type
							}
						})
						$scope.warnspecVideoFilter = false;
						$scope.warnspecLocationFilter = false;
						$scope.spiderChartData = $scope.spiderChartDataOri
						angular.element(document.querySelector('.warn-table-fullscreen')).bind('scroll', tablescroll)
						unwatcher = $scope.$watch('displayedCollection', displayColWatcherFunc, true);
						window.scrollTo(0,0)
						blockUi.removeClass('block-ui-active block-ui-visible')
					}
				}, function errorCallback(response) {
					blockUi.removeClass('block-ui-active block-ui-visible')
					var errorphp = httpSuccessCheck.checkerrorHttp(response)
					if (errorphp) {
						alertBox.errorAlert('91207_' + errorphp)
					} else {
						alertBox.errorAlert(response.data.code)
					}
				});
			}
		}
	}
	var scrollvflag = false
	var unwatcher
	var tablescroll = function () {
		var tablewrap = document.getElementsByClassName('warn-table-fullscreen')[0]
		var table = tablewrap.getElementsByTagName('table')[0]
		if (table) {
			var firstRow = table.children[1].children[0]
			if(firstRow && firstRow.children.length>1){
				var trh = table.children[0].children[0]
				var th = table.children[0]
				var cellwidth = []
				if (tablewrap.scrollTop > 0 && tablewrap.scrollTop &lt;= table.children[1].clientHeight) {
					for (var i = 0; i &lt; trh.children.length; i++) {
						var cellbody = firstRow.children[i]
						var cell = trh.children[i]
						var setWidth = cell.clientWidth > cellbody.clientWidth ? cell.clientWidth : cellbody.clientWidth
						cellwidth.push(setWidth)
					}
					if ((tablewrap.scrollHeight - tablewrap.clientHeight > table.children[0].children[0].clientHeight) && scrollvflag == false) {
						for (var i = 0; i &lt; cellwidth.length; i++) {
							firstRow.children[i].style.width = cellwidth[i] + 'px'
							trh.children[i].style.width = cellwidth[i] + 'px'
							firstRow.children[i].style.minWidth = cellwidth[i] + 'px'
							trh.children[i].style.minWidth = cellwidth[i] + 'px'
						}
						table.children[0].classList.add('table-stickyheader')
						table.children[0].style.top = '36px'
						table.children[0].style.position = 'absolute'
						table.children[0].style.overflow = 'hidden'
						var scrollbarWidth = tablewrap.offsetWidth - tablewrap.clientWidth
						table.children[0].style.width = 'calc( 100% - ' + scrollbarWidth + 'px )'
						scrollvflag = true
					}
					if (tablewrap.scrollLeft > 0) {
						table.children[0].scrollLeft = tablewrap.scrollLeft
					} else {
						var scrollbarWidth = tablewrap.offsetWidth - tablewrap.clientWidth
						table.children[0].scrollLeft = '-' + scrollbarWidth + 'px'
					}
				} else {
					scrollvflag = false
					var colength = firstRow.children.length&lt;=trh.children.length?firstRow.children.length:trh.children.length
					for (var j = 0; j &lt; colength; j++) {
						firstRow.children[j].removeAttribute("style")
						trh.children[j].removeAttribute("style")
					}
					/*for (var j = 0; j &lt; trh.children.length; j++) {
						firstRow.children[j].removeAttribute("style")
						trh.children[j].removeAttribute("style")
					}*/
					table.children[0].classList.remove('table-stickyheader')
					table.children[0].style.removeProperty('top')
					table.children[0].style.removeProperty('position')
					table.children[0].style.removeProperty('overflow')
					table.children[0].style.removeProperty('width')
				}
			}
		}
	}
	$scope.changePage = function (p) {
		unwatcher();
		angular.element(document.querySelector('.warn-table-fullscreen')).unbind('scroll')
		scrollvflag = false
		var tablewrap = document.getElementsByClassName('warn-table-fullscreen')[0]
		var table = tablewrap.getElementsByTagName('table')[0]
		var scrollY = tablewrap.scrollTop
		if (scrollY && scrollY > 0) {
			var firstRow = table.children[1].children[0]
			if(firstRow && firstRow.children.length>1){
				var trh = table.children[0].children[0]
				var th = table.children[0]
				var colength = firstRow.children.length&lt;=trh.children.length?firstRow.children.length:trh.children.length
				for (var j = 0; j &lt; colength; j++) {
					firstRow.children[j].removeAttribute("style")
					trh.children[j].removeAttribute("style")
				}
				/*for (var j = 0; j &lt; trh.children.length; j++) {
					firstRow.children[j].removeAttribute("style")
					trh.children[j].removeAttribute("style")
				}*/
				table.children[0].classList.remove('table-stickyheader')
				table.children[0].style.removeProperty('top')
				table.children[0].style.removeProperty('position')
				table.children[0].style.removeProperty('overflow')
				table.children[0].style.removeProperty('width')
			}
		}
		angular.element(document.querySelector('.warn-table-fullscreen'))[0].scrollTop = 0
		angular.element(document.querySelector('.warn-table-fullscreen')).bind('scroll', tablescroll)
		unwatcher = $scope.$watch('displayedCollection', displayColWatcherFunc, true);
		/*var tableWrap = angular.element(document.querySelector('.ng-table-content'))[0]
		tableWrap.scrollTop = 0;*/
	}
	$scope.setItemPer = function (num) {
		$scope.itemsByPageFull = num
	}
	$scope.closeSpider = function () {
		unwatcher();
		angular.element(document.querySelector('.warn-table-fullscreen')).unbind('scroll')
		scrollvflag = false
		var tablewrap = document.getElementsByClassName('warn-table-fullscreen')[0]
		var table = tablewrap.getElementsByTagName('table')[0]
		var scrollY = tablewrap.scrollTop
		if (scrollY && scrollY > 0) {
			var firstRow = table.children[1].children[0]
			if(firstRow && firstRow.children.length>1){
				var trh = table.children[0].children[0]
				var th = table.children[0]
				var colength = firstRow.children.length&lt;=trh.children.length?firstRow.children.length:trh.children.length
				for (var j = 0; j &lt; colength; j++) {
					firstRow.children[j].removeAttribute("style")
					trh.children[j].removeAttribute("style")
				}
				/*for (var j = 0; j &lt; trh.children.length; j++) {
					firstRow.children[j].removeAttribute("style")
					trh.children[j].removeAttribute("style")
				}*/
				table.children[0].classList.remove('table-stickyheader')
				table.children[0].style.removeProperty('top')
				table.children[0].style.removeProperty('position')
				table.children[0].style.removeProperty('overflow')
				table.children[0].style.removeProperty('width')
			}
		}
		angular.element(document.querySelector('.warn-table-fullscreen'))[0].scrollTop = 0
		angular.element(document.querySelector('.warn-table-fullscreen'))[0].scrollLeft = 0
		$scope.spiderChartFullScreen = false;
		document.getElementsByClassName("pro-wrap")[0].style.removeProperty('height');
		document.getElementsByClassName("pro-wrap")[0].style.removeProperty('overflow');
		window.scrollTo($scope.preFullScrollX, $scope.preFullScrollY)
		$scope.preFullScrollX = 0;
		$scope.preFullScrollY = 0;
	}
	$scope.spiderColor = chartConfig.spiderColor
	$scope.scoreTagOpts = chartConfig.scoreTagOpts
	$scope.scoreTagOptsTotal = chartConfig.scoreTagOptsTotal
	$scope.scoreChartOpts = chartConfig.scoreChartOpts
	$scope.scoreChartOptsTotal = chartConfig.scoreChartOptsTotal
	$scope.scoreChartTotalFix = chartConfig.scoreChartTotalFix
	$scope.scoreTagColorTotal = chartConfig.scoreTagColorTotal
	$scope.scoreTagColor = chartConfig.scoreTagColor
	$scope.videotypeSelect = chartConfig.videotypeSelect
	$scope.scoreTagOptsFull = chartConfig.scoreTagOptsFull
	$scope.scoreTagOptsTotalFull = chartConfig.scoreTagOptsTotalFull
	$scope.chartFullScreen = false;
	$scope.enlargeChart = function (chart) {
		$scope.preFullScrollX = window.pageXOffset;
		$scope.preFullScrollY = window.pageYOffset;
		$scope.chartFullScreen = true;
		if (chart == "safetyScore") {
			$scope.tagChartHeaderFullscreen = $translate.instant(chart)
			$scope.tagChartFullColor = $scope.scoreTagColorTotal;
			$scope.tagChartFullOpt = $scope.scoreTagOptsTotalFull;
		}
		else {
			$scope.tagChartHeaderFullscreen = $translate.instant(chart)+" "+$translate.instant('countRange');
			$scope.tagChartFullColor = $scope.scoreTagColor;
			$scope.tagChartFullOpt = $scope.scoreTagOptsFull;
		}
		document.getElementsByClassName("pro-wrap")[0].style.height = '100vh';
		document.getElementsByClassName("pro-wrap")[0].style.overflow = 'hidden';
		$scope.chartDataFullscreen = profileService.renderChartFullscreen(chart, $scope.chartSet, false);
	}
	$scope.closeChart = function () {
		$scope.chartFullScreen = false;
		document.getElementsByClassName("pro-wrap")[0].style.removeProperty('height');
		document.getElementsByClassName("pro-wrap")[0].style.removeProperty('overflow');
		window.scrollTo($scope.preFullScrollX, $scope.preFullScrollY)
		$scope.preFullScrollX = 0;
		$scope.preFullScrollY = 0;
	}
	$scope.hasAccess = function (perm) {
		if($scope.permission.indexOf(perm) !== -1){
			return true;
		}
		else{
			return false;
		}
	}
	$scope.toPage = function (page, data) {
		var passData = {
			preselected: {
				id: data.id,
				name: data.name
			},
			predistance: $scope.distanceselected,
			preview: $scope.periodselected,
			predate: $scope.dateRange
		}
		$state.goNewTab(page,passData)
	}
	$scope.updatelang = function () {
		var postData = {
			lang: $scope.lang
		}
		$http({
			method: 'POST',
			url: '/api/updateLang',
			data: postData
		}).then(function successCallback(response) {
			blockUi.removeClass('block-ui-active block-ui-visible')
			var errorphp = httpSuccessCheck.checkHttp(response)
			if (errorphp) {
				alertBox.errorAlert('90006_01')
				$scope.lang = $scope.userInfo.lang;
			} else {
				if ($scope.userInfo.map == 'googleMap') {
					refetchMapService.deleteGoogle()
				}
				$state.reload()
			}
		}, function errorCallback(response) {
			blockUi.removeClass('block-ui-active block-ui-visible')
			var errorphp = httpSuccessCheck.checkerrorHttp(response)
			if (errorphp) {
				alertBox.errorAlert('90006_' + errorphp)
			} else {
				alertBox.errorAlert(response.data.code)
			}
			$scope.lang = $scope.userInfo.lang;
		});
	}
	$scope.$on('IdleStart', function () {
		alertBox.idleAlert()
	})
	$scope.$on('IdleEnd', function () {
		swal.close(function () {
			clearInterval(timerInterval)
		})
	})
	$scope.$on('IdleTimeout', function () {
		if(angular.element(document.body).hasClass('md-dialog-is-showing')){
			$mdDialog.cancel()
		}
		swal.close(function () {
			clearInterval(timerInterval)
		})
		var func = function (result) {
			$state.go('login', {}, {
				reload: true
			})
		}
		$http({
			method: 'GET',
			url: '/api/logout'
		}).then(function successCallback(response) {
			blockUi.removeClass('block-ui-active block-ui-visible')
			alertBox.timeoutAlert(func)
		}, function errorCallback(response) {
			blockUi.removeClass('block-ui-active block-ui-visible')
			alertBox.timeoutAlert(func)
		});
	})
	$scope.optionList = false
	$scope.showOption = function () {
		$scope.optionList = !$scope.optionList
		if (!$scope.optionList) {
			$scope.period = $scope.periodselected
			$scope.drvDistance = $scope.distanceselected
			$scope.changeDateOption($scope.periodselected)
			$scope.dateselected = $scope.dateRange.after
			$scope.dateselectedafter = new Date(new Date($scope.dateselected).setDate(new Date($scope.dateselected).getDate() + 6)).setHours(0, 0, 0, 0)
		}
	}
	/*$scope.dateRange = {
		before: new Date(new Date(new Date(newdatetmp).setMonth(new Date(new Date().setDate(new Date().getDate() - 1)).getMonth() - 1)).setHours(0, 0, 0, 0)),
		after: new Date(new Date(newdatetmp).setHours(0, 0, 0, 0))
	};*/
	$scope.dateRange = {
		before: new Date(new Date(new Date(new Date(newdatetmp).setFullYear(new Date(newdatetmp).getFullYear() - 1)).setDate(1)).setHours(0, 0, 0, 0)),
		after: new Date(new Date(new Date(newdatetmp).setDate(1)).setHours(0, 0, 0, 0))
	};
	$scope.openPicker = function () {
		$scope.dateSelected.opened = !$scope.dateSelected.opened
		$timeout(function () {
			var datebutton = angular.element(document.querySelector('.pro-wrap .profile-header2 .pro-date-pick-btn-wrap .pro-date-pick-btn'))[0]
			var datepicker = angular.element(document.querySelector('.pro-wrap .profile-header2 .pro-date-pick .dropdown-menu'))[0]
			if (datepicker) {
				var element = angular.element(document.querySelector('head style#profile-datepicker'));
				if (datebutton.offsetWidth &lt; 248.5) {
					left = -248.5 + datebutton.offsetWidth + 1
					element.html('.pro-wrap .profile-header2 .pro-date-pick .dropdown-menu{left: ' + left + 'px !important;}');
				} else {
					element.html('.pro-wrap .profile-header2 .pro-date-pick .dropdown-menu{left: unset;}');
				}
			}
		})
	}
	$scope.changeRange = function (date) {
		var addDate = date.setHours(0, 0, 0, 0)
		$scope.dateselected = addDate
		if ($scope.period == 'w') {
			$scope.dateselectedafter = new Date(new Date($scope.dateselected).setDate(new Date($scope.dateselected).getDate() + 6)).setHours(0, 0, 0, 0)
		}
	}
	function disabledDate(data) {
		var date = data.date
		var mode = data.mode
		return (mode === 'day' && date.getDay() !== 1);
	}
	$scope.changeDateOption = function (period) {
		switch (period) {
			case 'd':
				$scope.dateSelectOptions = {
					maxDate: $scope.maxDate,
					minDate: $scope.minDate,
					startingDay: 1,
					showWeeks: false,
					formatMonth: 'MMM',
					yearColumns: 3
				};
				$scope.dateselected = new Date(new Date(newdatetmp).setHours(0, 0, 0, 0));
				break;
			case 'w':
				$scope.dateSelectOptions = {
					maxDate: $scope.maxDate,
					minDate: $scope.minDate,
					startingDay: 1,
					showWeeks: false,
					formatMonth: 'MMM',
					yearColumns: 3,
					dateDisabled: disabledDate
				};
				$scope.dateselected = new Date(new Date(newdatetmp).setHours(0, 0, 0, 0));
				var date = new Date($scope.dateselected).getDay()
				if (date !== 0) {
					var modifydate = new Date($scope.dateselected).setDate(new Date($scope.dateselected).getDate() - date + 1)
					$scope.dateselected = new Date(modifydate).setHours(0, 0, 0, 0)
				} else {
					var modifydate = new Date($scope.dateselected).setDate(new Date($scope.dateselected).getDate() - 6)
					$scope.dateselected = new Date(modifydate).setHours(0, 0, 0, 0)
				}
				$scope.dateselectedafter = new Date(new Date($scope.dateselected).setDate(new Date($scope.dateselected).getDate() + 6)).setHours(0, 0, 0, 0)
				break;
			case 'm':
				$scope.dateSelectOptions = {
					maxDate: $scope.maxDate,
					minDate: $scope.minDate,
					minMode: 'month',
					startingDay: 1,
					showWeeks: false,
					formatMonth: 'MMM',
					yearColumns: 3
				};
				$scope.dateselected = new Date(new Date(newdatetmp).setHours(0, 0, 0, 0));
				var modifydate = new Date($scope.dateselected).setDate(1)
				$scope.dateselected = new Date(modifydate).setHours(0, 0, 0, 0)
				break;
			case 'y':
				$scope.dateSelectOptions = {
					maxDate: $scope.maxDate,
					minDate: $scope.minDate,
					minMode: 'year',
					startingDay: 1,
					showWeeks: false,
					yearColumns: 3
				};
				$scope.dateselected = new Date(new Date(newdatetmp).setHours(0, 0, 0, 0));
				var modifydate = new Date($scope.dateselected).setMonth(0, 1)
				$scope.dateselected = new Date(modifydate).setHours(0, 0, 0, 0)
		}
		$scope.period = period
	}
	angular.element(document.querySelector('head')).append("&lt;style id='profile-datepicker'>&lt;/style>");
	angular.element($window).bind('resize', function () {
		if (window.innerWidth >= 992) {
			if ($scope.accordion.scorechartOpened || $scope.accordion.ddbchartOpened) {
				$scope.accordion.scorechartOpened = true
				$scope.accordion.ddbchartOpened = true
			}
			if ($scope.accordion.comfortchartOpened || $scope.accordion.bdbchartOpened) {
				$scope.accordion.comfortchartOpened = true
				$scope.accordion.bdbchartOpened = true
			}
			$scope.$apply()
		}
		if ($scope.spiderChartFullScreen) {
			var tablewrap = document.getElementsByClassName('warn-table-fullscreen')[0]
			var table = tablewrap.getElementsByTagName('table')[0]
			var scrollY = tablewrap.scrollTop
			if (scrollY && scrollY > 0 && tablewrap.scrollTop &lt;= table.children[1].clientHeight) {
				var firstRow = table.children[1].children[0]
				if(firstRow && firstRow.children.length>1){
					var trh = table.children[0].children[0]
					var th = table.children[0]
					var colength = firstRow.children.length&lt;=trh.children.length?firstRow.children.length:trh.children.length
					for (var j = 0; j &lt; colength; j++) {
						firstRow.children[j].removeAttribute("style")
						trh.children[j].removeAttribute("style")
					}
					/*for (var j = 0; j &lt; trh.children.length; j++) {
						firstRow.children[j].removeAttribute("style")
						trh.children[j].removeAttribute("style")
					}*/
					table.children[0].classList.remove('table-stickyheader')
					table.children[0].style.removeProperty('top')
					table.children[0].style.removeProperty('position')
					table.children[0].style.removeProperty('overflow')
					table.children[0].style.removeProperty('width')
					tablewrap.style.overflow = 'hidden'
					$scope.$apply()
					$timeout(function () {
						tablewrap.style.removeProperty('overflow')
						var cellwidth = []
						for (var i = 0; i &lt; trh.children.length; i++) {
							var cellbody = firstRow.children[i]
							var cell = trh.children[i]
							var setWidth = cell.clientWidth > cellbody.clientWidth ? cell.clientWidth : cellbody.clientWidth
							cellwidth.push(setWidth)
						}
						for (var i = 0; i &lt; cellwidth.length; i++) {
							firstRow.children[i].style.width = cellwidth[i] + 'px'
							trh.children[i].style.width = cellwidth[i] + 'px'
							firstRow.children[i].style.minWidth = cellwidth[i] + 'px'
							trh.children[i].style.minWidth = cellwidth[i] + 'px'
						}
						table.children[0].classList.add('table-stickyheader')
						table.children[0].style.top = '36px'
						table.children[0].style.position = 'absolute'
						table.children[0].style.overflow = 'hidden'
						var scrollbarWidth = tablewrap.offsetWidth - tablewrap.clientWidth
						table.children[0].style.width = 'calc( 100% - ' + scrollbarWidth + 'px )'
					}, true)
				}
			}
		}
		var datebutton = angular.element(document.querySelector('.pro-wrap .profile-header2 .pro-date-pick-btn-wrap .pro-date-pick-btn'))[0]
		var datepicker = angular.element(document.querySelector('.pro-wrap .profile-header2 .pro-date-pick .dropdown-menu'))[0]
		if (datepicker) {
			var element = angular.element(document.querySelector('head style#profile-datepicker'));
			if (datebutton.offsetWidth &lt; 248.5) {
				left = -248.5 + datebutton.offsetWidth + 1
				element.html('.pro-wrap .profile-header2 .pro-date-pick .dropdown-menu{left: ' + left + 'px !important;}');
			} else {
				element.html('.pro-wrap .profile-header2 .pro-date-pick .dropdown-menu{left: unset;}');
			}
		}
	})
	$scope.submitOption = function ($event) {
		if ($event) {
			$event.stopPropagation();
			$event.preventDefault();
		}
		$scope.distanceselected = $scope.drvDistance
		$scope.periodselected = $scope.period
		$scope.dateRangeafter = $scope.dateselectedafter
		switch ($scope.periodselected) {
			case 'd':
				$scope.dateRange.before = new Date(new Date($scope.dateselected).setMonth(new Date($scope.dateselected).getMonth() - 1)).setHours(0, 0, 0, 0)
				$scope.dateRange.after = new Date($scope.dateselected).setHours(0, 0, 0, 0)
				break;
			case 'w':
				$scope.dateRange.before = new Date(new Date($scope.dateselected).setDate(new Date($scope.dateselected).getDate() - 7 * 14)).setHours(0, 0, 0, 0)
				$scope.dateRange.after = new Date($scope.dateselected).setHours(0, 0, 0, 0)
				break;
			case 'm':
				$scope.dateRange.before = new Date(new Date($scope.dateselected).setFullYear(new Date($scope.dateselected).getFullYear() - 1)).setHours(0, 0, 0, 0)
				//var afdate = new Date($scope.dateselected).setMonth(new Date($scope.dateselected).getMonth()+1)
				$scope.dateRange.after = new Date($scope.dateselected).setHours(0, 0, 0, 0)
				break;
			case 'y':
				$scope.dateRange.before = new Date(new Date($scope.dateselected).setFullYear(new Date($scope.dateselected).getFullYear() - 7)).setHours(0, 0, 0, 0)
				//var afdate = new Date($scope.dateselected).setFullYear(new Date($scope.dateselected).getFullYear()+1)
				$scope.dateRange.after = new Date($scope.dateselected).setHours(0, 0, 0, 0)
		}
		$scope.getCompScore(true)
		$scope.optionList = false
	}
	$scope.getWarnVideo = function (date) {
		$scope.loadingdata.video = true;
		var range = profileService.getExactDateRange(date, $scope.periodselected)
		var tmp1 = new Date(range.datebf).setHours(0, 0, 0, 0)
		var tmp2 = new Date(range.dateaf).setHours(23, 59, 59, 59)
		var datebf = $filter('date')(tmp1, 'yyyy-MM-dd')
		var dateaf = $filter('date')(tmp2, 'yyyy-MM-dd')
		$http({
			method: 'GET',
			url: '/api/profileVideo/c/' + datebf + '/' + dateaf
		}).then(function successCallback(response) {
			var errorphp = httpSuccessCheck.checkHttp(response)
			if (errorphp) {
				$scope.loadingdata.video = false;
				alertBox.errorAlert('91208_01')
			} else {
				var data = response.data.data
				$scope.warnvideoCollection = data.map(function (obj) {
					return {
						duration: obj.duration,
						end_spd: obj.end_spd,
						hw: obj.hw,
						near_hw: obj.near_hw,
						roc: obj.roc,
						start_spd: obj.start_spd,
						start_time: obj.start_time,
						vehicle: obj.vehicle,
						vehDepart: obj.vehDepartment,
						driver: obj.driver,
						drvDepart: obj.drvDepartment,
						vehStatus: obj.vehStatus,
						top_spd: obj.top_spd,
						video: obj.video,
						videoReady: obj.videoReady,
						warningType: obj.warningType,
						gps: obj.gps,
						rawgps: obj.rawgps
					}
				})
				$scope.loadingdata.video = false;
			}
		}, function errorCallback(response) {
			$scope.loadingdata.video = false;
			var errorphp = httpSuccessCheck.checkerrorHttp(response)
			if (errorphp) {
				alertBox.errorAlert('91208_' + errorphp)
			} else {
				alertBox.errorAlert(response.data.code)
			}
		});
	}
	$scope.checkState = function (state, num) {
		return (state & Math.pow(2,num)) == Math.pow(2,num)
	}
	$scope.getCompScore = function (submit) {
		$scope.loadingdata.company = true;
		var datebf = $filter('date')($scope.dateRange.before, 'yyyy-MM-dd')
		var dateaf = $filter('date')($scope.dateRange.after, 'yyyy-MM-dd')
		$http({
			method: 'GET',
			url: '/api/companyScore/' + $scope.periodselected.toUpperCase() + '/' + ($scope.distanceselected*10*100000)/10 + '/' + datebf + '/' + dateaf
		}).then(function successCallback(response) {
			var errorphp = httpSuccessCheck.checkHttp(response)
			if (errorphp) {
				$scope.loadingdata.company = false;
				blockUi.removeClass('block-ui-active block-ui-visible')
				alertBox.errorAlert('91201_01')
				if (submit) {
					$scope.getDrvGrpScore($scope.dateRange.after)
					$scope.getDriverScore($scope.dateRange.after)
					$scope.getVehGrpScore($scope.dateRange.after)
					$scope.getVehicleScore($scope.dateRange.after)
					$scope.getWarnVideo($scope.dateRange.after)
					$scope.getRank($scope.dateRange.after)
				}
			}
			else {
				$scope.companyCollection = response.data.data
				$scope.companyActCollection = response.data.dataActCnt
				if ($scope.companyCollection.length > 0) {
					var tmp = angular.copy($scope.companyCollection[$scope.companyCollection.length - 1])
					//tmp.label = profileService.getscoreLabel(parseInt(tmp.total_score))
					tmp.spiderset = profileService.getSpiderData(tmp)
					tmp.dataAsAt = profileService.getDataAsAt(tmp.acc_date, $scope.periodselected)
					$scope.recentRecord = angular.copy(tmp)
					$scope.chartSet = profileService.renderChartData(angular.copy($scope.companyCollection), $scope.periodselected)
					var func = function (submit, tmp) {
						if (submit) {
							$scope.getDrvGrpScore(tmp.acc_date)
							$scope.getDriverScore(tmp.acc_date)
							$scope.getVehGrpScore(tmp.acc_date)
							$scope.getVehicleScore(tmp.acc_date)
							$scope.getWarnVideo(tmp.acc_date)
							$scope.getRank(tmp.acc_date)
						}
					}
					if (dateaf !== tmp.acc_date) {
						var selectedRecordPeriod = profileService.getDataAsAt(dateaf, $scope.periodselected)
						alertBox.asAtDateAlert('company', $scope.distanceselected, selectedRecordPeriod, tmp.dataAsAt, $scope.periodselected, submit, tmp, func)
					} else {
						func(submit, tmp)
					}
				} else {
					$scope.recentRecord = {
						total_score: 0,
						grade: 'N/A'
					}
					$scope.recentRecord.spiderset = profileService.renderEmptySpider()
					$scope.chartSet = profileService.renderEmptyChart($scope.periodselected)
					var func = function (submit, date) {
						if (submit) {
							$scope.getDrvGrpScore(date)
							$scope.getDriverScore(date)
							$scope.getVehGrpScore(date)
							$scope.getVehicleScore(date)
							$scope.getWarnVideo(date)
							$scope.getRank(date)
						}
					}
					var start = profileService.getDataAsAt(datebf, $scope.periodselected)
					var end = profileService.getDataAsAt(dateaf, $scope.periodselected)
					alertBox.noProfileRecordAlert('company', $scope.distanceselected, start, end, $scope.periodselected, submit, $scope.dateRange.after, func)
				}
				$timeout(function(){
					$scope.spiderPoint = $scope.getSpiderPoint();
					$scope.$apply()
				},true)
				$scope.loadingdata.company = false;
				blockUi.removeClass('block-ui-active block-ui-visible')
			}
		}, function errorCallback(response) {
			$scope.loadingdata.company = false;
			blockUi.removeClass('block-ui-active block-ui-visible')
			var errorphp = httpSuccessCheck.checkerrorHttp(response)
			if (errorphp) {
				alertBox.errorAlert('91201_' + errorphp)
			} else {
				alertBox.errorAlert(response.data.code)
			}
			if (submit) {
				$scope.getDrvGrpScore($scope.dateRange.after)
				$scope.getDriverScore($scope.dateRange.after)
				$scope.getVehGrpScore($scope.dateRange.after)
				$scope.getVehicleScore($scope.dateRange.after)
				$scope.getWarnVideo($scope.dateRange.after)
				$scope.getRank($scope.dateRange.after)
			}
		});
	}
	$scope.getDrvGrpScore = function (date) {
		$scope.loadingdata.drvgrp = true;
		var range = profileService.getExactDateRange(date, $scope.periodselected)
		var tmp1 = new Date(range.datebf).setHours(0, 0, 0, 0)
		var tmp2 = new Date(range.dateaf).setHours(23, 59, 59, 59)
		var datebf = $filter('date')(tmp1, 'yyyy-MM-dd')
		var dateaf = $filter('date')(tmp2, 'yyyy-MM-dd')
		$http({
			method: 'GET',
			url: '/api/drvgrpScore/' + $scope.periodselected.toUpperCase() + '/' + ($scope.distanceselected*10*100000)/10 + '/' + datebf + '/' + dateaf + '/c'
		}).then(function successCallback(response) {
			var errorphp = httpSuccessCheck.checkHttp(response)
			if (errorphp) {
				$scope.loadingdata.drvgrp = false;
				alertBox.errorAlert('91202_01')
			} else {
				$scope.drvgrpCollection = response.data.data
				$scope.drvgrpActCollection = response.data.dataActCnt
				$scope.loadingdata.drvgrp = false;
			}
		}, function errorCallback(response) {
			$scope.loadingdata.drvgrp = false;
			var errorphp = httpSuccessCheck.checkerrorHttp(response)
			if (errorphp) {
				alertBox.errorAlert('91202_' + errorphp)
			} else {
				alertBox.errorAlert(response.data.code)
			}
		});
	}
	$scope.getDriverScore = function (date) {
		$scope.loadingdata.drv = true;
		var range = profileService.getExactDateRange(date, $scope.periodselected)
		var tmp1 = new Date(range.datebf).setHours(0, 0, 0, 0)
		var tmp2 = new Date(range.dateaf).setHours(23, 59, 59, 59)
		var datebf = $filter('date')(tmp1, 'yyyy-MM-dd')
		var dateaf = $filter('date')(tmp2, 'yyyy-MM-dd')
		$http({
			method: 'GET',
			url: '/api/driverScore/' + $scope.periodselected.toUpperCase() + '/' + ($scope.distanceselected*10*100000)/10 + '/' + datebf + '/' + dateaf + '/c'
		}).then(function successCallback(response) {
			var errorphp = httpSuccessCheck.checkHttp(response)
			if (errorphp) {
				$scope.loadingdata.drv = false;
				alertBox.errorAlert('91203_01')
			} else {
				$scope.drvCollection = response.data.data
				$scope.drvActCollection = response.data.dataActCnt
				$scope.loadingdata.drv = false;
			}
		}, function errorCallback(response) {
			$scope.loadingdata.drv = false;
			var errorphp = httpSuccessCheck.checkerrorHttp(response)
			if (errorphp) {
				alertBox.errorAlert('91203_' + errorphp)
			} else {
				alertBox.errorAlert(response.data.code)
			}
		});
	}
	$scope.getVehGrpScore = function (date) {
		$scope.loadingdata.vehgrp = true;
		var range = profileService.getExactDateRange(date, $scope.periodselected)
		var tmp1 = new Date(range.datebf).setHours(0, 0, 0, 0)
		var tmp2 = new Date(range.dateaf).setHours(23, 59, 59, 59)
		var datebf = $filter('date')(tmp1, 'yyyy-MM-dd')
		var dateaf = $filter('date')(tmp2, 'yyyy-MM-dd')
		$http({
			method: 'GET',
			url: '/api/vehgrpScore/' + $scope.periodselected.toUpperCase() + '/' + ($scope.distanceselected*10*100000)/10 + '/' + datebf + '/' + dateaf + '/c'
		}).then(function successCallback(response) {
			var errorphp = httpSuccessCheck.checkHttp(response)
			if (errorphp) {
				$scope.loadingdata.vehgrp = false;
				alertBox.errorAlert('91204_01')
			} else {
				$scope.vehgrpCollection = response.data.data
				$scope.vehgrpActCollection = response.data.dataActCnt
				$scope.loadingdata.vehgrp = false;
			}
		}, function errorCallback(response) {
			$scope.loadingdata.vehgrp = false;
			var errorphp = httpSuccessCheck.checkerrorHttp(response)
			if (errorphp) {
				alertBox.errorAlert('91204_' + errorphp)
			} else {
				alertBox.errorAlert(response.data.code)
			}
		});
	}
	$scope.getVehicleScore = function (date) {
		$scope.loadingdata.veh = true;
		var range = profileService.getExactDateRange(date, $scope.periodselected)
		var tmp1 = new Date(range.datebf).setHours(0, 0, 0, 0)
		var tmp2 = new Date(range.dateaf).setHours(23, 59, 59, 59)
		var datebf = $filter('date')(tmp1, 'yyyy-MM-dd')
		var dateaf = $filter('date')(tmp2, 'yyyy-MM-dd')
		$http({
			method: 'GET',
			url: '/api/vehicleScore/' + $scope.periodselected.toUpperCase() + '/' + ($scope.distanceselected*10*100000)/10 + '/' + datebf + '/' + dateaf + '/c'
		}).then(function successCallback(response) {
			var errorphp = httpSuccessCheck.checkHttp(response)
			if (errorphp) {
				$scope.loadingdata.veh = false;
				alertBox.errorAlert('91205_01')
			} else {
				$scope.vehCollection = response.data.data
				$scope.vehActCollection = response.data.dataActCnt
				$scope.loadingdata.veh = false;
			}
		}, function errorCallback(response) {
			$scope.loadingdata.veh = false;
			var errorphp = httpSuccessCheck.checkerrorHttp(response)
			if (errorphp) {
				alertBox.errorAlert('91205_' + errorphp)
			} else {
				alertBox.errorAlert(response.data.code)
			}
		});
	}
	$scope.getRank = function (date) {
		$scope.loadingdata.rank = true;
		var range = profileService.getExactDateRange(date, $scope.periodselected)
		//var range = profileService.getExactDateRange($scope.dateRange.after, $scope.periodselected)
		var tmp1 = new Date(range.datebf).setHours(0, 0, 0, 0)
		var tmp2 = new Date(range.dateaf).setHours(23, 59, 59, 59)
		var datebf = $filter('date')(tmp1, 'yyyy-MM-dd')
		var dateaf = $filter('date')(tmp2, 'yyyy-MM-dd')
		$http({
			method: 'GET',
			url: '/api/warningRank/' + $scope.periodselected.toUpperCase() + '/' + ($scope.distanceselected*10*100000)/10 + '/' + datebf + '/' + dateaf + '/c'
		}).then(function successCallback(response) {
			var errorphp = httpSuccessCheck.checkHttp(response)
			if (errorphp) {
				$scope.loadingdata.rank = false;
				alertBox.errorAlert('91206_01')
			} else {
				$scope.vehRankCollection = response.data.vehicleRank
				$scope.drvRankCollection = response.data.driverRank
				$scope.loadingdata.rank = false;
			}
		}, function errorCallback(response) {
			$scope.loadingdata.rank = false;
			var errorphp = httpSuccessCheck.checkerrorHttp(response)
			if (errorphp) {
				alertBox.errorAlert('91206_' + errorphp)
			} else {
				alertBox.errorAlert(response.data.code)
			}
		});
	}
	$scope.loadingdata = {
		company: false,
		drvgrp: false,
		vehgrp: false,
		drv: false,
		veh: false,
		rank: false,
		video: false,
		warnspec: false
	}
	$scope.getCompScore(true)
	$scope.refreshData = function (table) {
		blockUi.addClass('block-ui-active block-ui-visible')
		var date
		if ($scope.recentRecord.acc_date) {
			date = $scope.recentRecord.acc_date
		} else {
			date = $scope.dateRange.after
		}
		switch (table) {
			case 'company':
				$scope.getCompScore()
				break;
			case 'drvgrp':
				$scope.getDrvGrpScore(date)
				break;
			case 'driver':
				$scope.getDriverScore(date)
				break;
			case 'vehgrp':
				$scope.getVehGrpScore(date)
				break;
			case 'vehicle':
				$scope.getVehicleScore(date)
				break;
			case 'rank':
				$scope.getRank(date)
				break;
			case 'video':
				$scope.getWarnVideo(date)
				break;
		}
		blockUi.removeClass('block-ui-active block-ui-visible')
	}
	$scope.accordion = {
		warnvideotableOpened: false,
		comwarnacttableOpened: false,
		drvgrpwarnacttableOpened: false,
		drvwarnacttableOpened: false,
		vehgrpwarnacttableOpened: false,
		vehwarnacttableOpened: false,
		comwarntableOpened: false,
		drvgrpwarntableOpened: false,
		drvwarntableOpened: false,
		vehgrpwarntableOpened: false,
		vehwarntableOpened: false,
		comscoretableOpened: false,
		drvgrpscoretableOpened: false,
		drvscoretableOpened: false,
		vehgrpscoretableOpened: false,
		vehscoretableOpened: false,
		drvRanktableOpened: false,
		vehRanktableOpened: false,
		scorechartOpened: false,
		ddbchartOpened: false,
		bdbchartOpened: false,
		comfortchartOpened: false
	}
	$scope.playVideo = function ($event, id, licence) {
		$mdDialog.show({
				controller: DialogController,
				templateUrl: '/view/component/dialog/warnVideoDialog.html',
				parent: angular.element(document.querySelector('.pro-wrap')),
				targetEvent: $event,
				locals: {
					videoLink: appConfig.video + licence + '/' + id,
					lang: $scope.lang
				},
				clickOutsideToClose: false,
				escapeToClose: false,
				focusOnOpen: false,
				//hasBackdrop:true,
				disableParentScroll: true,
				fullscreen: true // Only for -xs, -sm breakpoints.
			})
			.then(function (answer) {
			}, function () {
				//angular.element($window).unbind('resize')
				if (window.innerWidth >= 992) {
					if ($scope.accordion.scorechartOpened || $scope.accordion.ddbchartOpened) {
						$scope.accordion.scorechartOpened = true
						$scope.accordion.ddbchartOpened = true
					}
					if ($scope.accordion.comfortchartOpened || $scope.accordion.bdbchartOpened) {
						$scope.accordion.comfortchartOpened = true
						$scope.accordion.bdbchartOpened = true
					}
				}
				var datebutton = angular.element(document.querySelector('.pro-wrap .profile-header2 .pro-date-pick-btn-wrap .pro-date-pick-btn'))[0]
				var datepicker = angular.element(document.querySelector('.pro-wrap .profile-header2 .pro-date-pick .dropdown-menu'))[0]
				if (datepicker) {
					var element = angular.element(document.querySelector('head style#profile-datepicker'));
					if (datebutton.offsetWidth &lt; 248.5) {
						left = -248.5 + datebutton.offsetWidth + 1
						element.html('.pro-wrap .profile-header2 .pro-date-pick .dropdown-menu{left: ' + left + 'px !important;}');
					} else {
						element.html('.pro-wrap .profile-header2 .pro-date-pick .dropdown-menu{left: unset;}');
					}
				}
				angular.element($window).bind('resize', function () {
					if (window.innerWidth >= 992) {
						if ($scope.accordion.scorechartOpened || $scope.accordion.ddbchartOpened) {
							$scope.accordion.scorechartOpened = true
							$scope.accordion.ddbchartOpened = true
						}
						if ($scope.accordion.comfortchartOpened || $scope.accordion.bdbchartOpened) {
							$scope.accordion.comfortchartOpened = true
							$scope.accordion.bdbchartOpened = true
						}
						$scope.$apply()
					}
					if ($scope.spiderChartFullScreen) {
						var tablewrap = document.getElementsByClassName('warn-table-fullscreen')[0]
						var table = tablewrap.getElementsByTagName('table')[0]
						var scrollY = tablewrap.scrollTop
						if (scrollY && scrollY > 0 && tablewrap.scrollTop &lt;= table.children[1].clientHeight) {
							var firstRow = table.children[1].children[0]
							if(firstRow && firstRow.children.length>1){
								var trh = table.children[0].children[0]
								var th = table.children[0]
								var colength = firstRow.children.length&lt;=trh.children.length?firstRow.children.length:trh.children.length
								for (var j = 0; j &lt; colength; j++) {
									firstRow.children[j].removeAttribute("style")
									trh.children[j].removeAttribute("style")
								}
								/*for (var j = 0; j &lt; trh.children.length; j++) {
									firstRow.children[j].removeAttribute("style")
									trh.children[j].removeAttribute("style")
								}*/
								table.children[0].classList.remove('table-stickyheader')
								table.children[0].style.removeProperty('top')
								table.children[0].style.removeProperty('position')
								table.children[0].style.removeProperty('overflow')
								table.children[0].style.removeProperty('width')
								tablewrap.style.overflow = 'hidden'
								$scope.$apply()
								$timeout(function () {
									tablewrap.style.removeProperty('overflow')
									var cellwidth = []
									for (var i = 0; i &lt; trh.children.length; i++) {
										var cellbody = firstRow.children[i]
										var cell = trh.children[i]
										var setWidth = cell.clientWidth > cellbody.clientWidth ? cell.clientWidth : cellbody.clientWidth
										cellwidth.push(setWidth)
									}
									for (var i = 0; i &lt; cellwidth.length; i++) {
										firstRow.children[i].style.width = cellwidth[i] + 'px'
										trh.children[i].style.width = cellwidth[i] + 'px'
										firstRow.children[i].style.minWidth = cellwidth[i] + 'px'
										trh.children[i].style.minWidth = cellwidth[i] + 'px'
									}
									table.children[0].classList.add('table-stickyheader')
									table.children[0].style.top = '36px'
									table.children[0].style.position = 'absolute'
									table.children[0].style.overflow = 'hidden'
									var scrollbarWidth = tablewrap.offsetWidth - tablewrap.clientWidth
									table.children[0].style.width = 'calc( 100% - ' + scrollbarWidth + 'px )'
								}, true)
							}
						}
					}
					var datebutton = angular.element(document.querySelector('.pro-wrap .profile-header2 .pro-date-pick-btn-wrap .pro-date-pick-btn'))[0]
					var datepicker = angular.element(document.querySelector('.pro-wrap .profile-header2 .pro-date-pick .dropdown-menu'))[0]
					if (datepicker) {
						var element = angular.element(document.querySelector('head style#profile-datepicker'));
						if (datebutton.offsetWidth &lt; 248.5) {
							left = -248.5 + datebutton.offsetWidth + 1
							element.html('.pro-wrap .profile-header2 .pro-date-pick .dropdown-menu{left: ' + left + 'px !important;}');
						} else {
							element.html('.pro-wrap .profile-header2 .pro-date-pick .dropdown-menu{left: unset;}');
						}
					}
				})
			});
	}
	function DialogController($scope, $mdDialog, videoLink, lang, $window, httpSuccessCheck, appConfig, $translate) {
		angular.element($window).unbind('resize')
		var html = document.getElementsByTagName('HTML')[0]
		html.style.msOverflowStyle = 'none';
		$timeout(function () {
			html.style.removeProperty('overflow-y')
		})
		$scope.posterLink = appConfig.videoLoad
		$scope.videoLink = videoLink
		$scope.cancel = function () {
			$mdDialog.cancel();
		};
		/*$scope.setVideo = function () {
			var element = angular.element(document.querySelector('.warn-dialog'))
			if (element[0].children[0].clientHeight == $window.innerHeight) {
				element[0].children[0].style.marginLeft = 'calc( ( 100vw - 177.78vh ) / 2 )'
				element[0].children[1].style.marginRight = 'calc( ( 100vw - 177.78vh ) / 2 )'
			} else {
				element[0].children[0].style.removeProperty('margin-left')
				element[0].children[1].style.removeProperty('margin-right')
			}
			if (element[0].children[0].clientWidth == $window.innerWidth) {
				element[0].children[0].style.marginTop = 'calc( ( 100vh - 56.25vw ) / 2 )'
				element[0].children[1].style.marginTop = 'calc( ( 100vh - 56.25vw ) / 2 )'
			} else {
				element[0].children[0].style.removeProperty('margin-top')
				element[0].children[1].style.removeProperty('margin-top')
			}
		}
		angular.element($window).on('resize', $scope.setVideo)
		$scope.$watch([$window.innerHeight, $window.innerWidth], function (newValue, oldValue) {
			$scope.setVideo();
		})
		$scope.handleError = function () {
			$scope.posterLink = appConfig.videoError
		}*/
		$scope.setVideo = function () {
			var element = angular.element(document.querySelector('.warn-dialog'))
			if (element[0].children[0].clientHeight == $window.innerHeight) {
				element[0].children[0].style.marginLeft = 'calc( ( 100vw - 177.78vh ) / 2 )'
			} else {
				element[0].children[0].style.removeProperty('margin-left')
			}
			if (element[0].children[0].clientWidth == $window.innerWidth) {
				element[0].children[0].style.marginTop = 'calc( ( 100vh - 56.25vw ) / 2 )'
			} else {
				element[0].children[0].style.removeProperty('margin-top')
			}
		}
		var options = appConfig.videoOptions
		options.language = lang
		var player
		angular.element(document).ready(function () {
	        player = videojs('warn-video',options);
	        player.poster($scope.posterLink);
			player.src({type: 'video/mp4', src: $scope.videoLink});
		    player.on("click", function(event){
				if(event.target.title=="Close"||event.target.title==$translate.instant("close")||event.target.parentElement.title=="Close"||event.target.parentElement.title==$translate.instant("close")){
					event.preventDefault();
					player.dispose()
					player = null
					$scope.cancel()
				}
		    });
		    player.on("error", function(event){
		    	player.loadingSpinner.hide()
		        $scope.posterLink = appConfig.videoError
		        player.poster($scope.posterLink);
		    });
		    angular.element($window).on('resize', $scope.setVideo)
			$scope.$watch([$window.innerHeight, $window.innerWidth], function (newValue, oldValue) {
				$scope.setVideo();
			})
	    });
	    $scope.$on('$destroy', function () {
	    	if(player){
				player.dispose()
			}
			html.style.removeProperty('-ms-overflow-style')
			angular.element($window).off('resize')
			angular.element(document.body)[0].style.removeProperty('position');
		})
	}
	DialogController.$inject = ["$scope", "$mdDialog", "videoLink", "lang", "$window", "httpSuccessCheck", "appConfig", "$translate"];
	$scope.showRecommendation = function () {
		var result = false;
		if (!$scope.recentRecord) {
			return result;
		}
		else {
			for (var i = 0; i &lt; $scope.dataFieldSet.length; i++) {
				for (var j = 0; j &lt; $scope.dataFieldSet[i].length; j++) {
					if ($scope.recentRecord[$scope.dataFieldSet[i][j]+'_score'] &lt; 30) {
						result = true;
					}
				}
			}
			/*if ($scope.recentRecord.pcw_score &lt; 30) {
				result = true;
			} else if ($scope.recentRecord.fcw_score &lt; 30) {
				result = true;
			} else if ($scope.recentRecord.ufcw_l_score &lt; 30 || $scope.recentRecord.ufcw_h_score &lt; 30) {
				result = true;
			} else if ($scope.recentRecord.spw_score &lt; 30) {
				result = true;
			} else if ($scope.recentRecord.hmw_h_score &lt; 30 || $scope.recentRecord.hmw_m_score &lt; 30 || $scope.recentRecord.hmw_l_score &lt; 30) {
				result = true;
			} else if ($scope.recentRecord.lldw_score &lt; 30 || $scope.recentRecord.rldw_score &lt; 30) {
				result = true;
			} else if ($scope.recentRecord.abw_score &lt; 30) {
				result = true;
			} else if ($scope.recentRecord.aaw_score &lt; 30) {
				result = true;
			}*/
			return result;
		}
	}
	$scope.$watch('accordion.scorechartOpened', function (newValues, oldValues) {
		if (window.innerWidth >= 992) {
			$scope.accordion.ddbchartOpened = newValues
		}
	})
	$scope.$watch('accordion.ddbchartOpened', function (newValues, oldValues) {
		if (window.innerWidth >= 992) {
			$scope.accordion.scorechartOpened = newValues
		}
	})
	$scope.$watch('accordion.bdbchartOpened', function (newValues, oldValues) {
		if (window.innerWidth >= 992) {
			$scope.accordion.comfortchartOpened = newValues
		}
	})
	$scope.$watch('accordion.comfortchartOpened', function (newValues, oldValues) {
		if (window.innerWidth >= 992) {
			$scope.accordion.bdbchartOpened = newValues
		}
	})
	$scope.$on('$destroy', function () {
		if(angular.element(document.body).hasClass('md-dialog-is-showing')){
			$mdDialog.cancel()
		}
		angular.element($window).unbind('resize');
		document.head.removeChild(document.querySelectorAll('head style#profile-datepicker')[0])
	})
}]);</code></pre>
        </article>
        <!-- index.html -->
        <!-- class files -->
      </div>
      <footer style="clear:both">
        Documentation generated by
        <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a>
        using
        <a href="https://github.com/allenhwkim/angular-jsdoc">Angular-JSDoc template</a>
      </footer>
    </div>
    <script src="js/prettify.js"></script>
    <script src="js/angular.min.js"></script>
    <script src="js/site.js"></script>
    <!--%= prettyJson %-->
    <script>
      prettyPrint();
      var lineNo = window.location.hash.match(/#line([0-9]+)$/);
      lineNo && document.querySelector("ol li:nth-child("+(lineNo[1])+")").scrollIntoView();
    </script>
  </body>
</html>