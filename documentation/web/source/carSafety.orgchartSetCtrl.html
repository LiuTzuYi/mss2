<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <base href="../">
    <title>JSDoc: source : orgchartSetCtrl.js</title>
    <link href="css/prettify-tomorrow.css" type="text/css" rel="stylesheet">
    <link href="css/site.css" type="text/css" rel="stylesheet">
    <link href="css/custom.css" type="text/css" rel="stylesheet">
  </head>
  <body ng-app>
    <nav id="toc">
      <div class="sidenav-search">
      <input placeholder="Filter" id="filter-input" class="col12 block field" type="text">
      </div>
      <div class="nav-wrapper">
      <h2><a href="index.html">Home</a></h2>
      <ul class="module">
        <!-- undefined -->
        <li id="undefined" ng-hide="moduleundefined">
          <ul class="group">
            <h2 class="nav-group">
              <a href ng-click="undefinedModule = !undefinedModule">
                Module
              </a>
              <i ng-cloak ng-show="undefinedModule">+</i>
            </h2>
            <ul ng-hide="undefinedModule">
              <li>
                <a href="carSafety.html">carSafety</a>
              </li>
            </ul>
          </ul>
        </li>
      </ul><ul class="module">
        <!-- car_afety -->
        <h2 class="module">
          <a chref ng-click="modulecar_afety = !modulecar_afety">
            module: carSafety
          </a>
          <i ng-cloak ng-show="modulecar_afety">+</i>
        </h2>
        <li id="carSafety" ng-hide="modulecar_afety">
          <ul class="group">
            <h2 class="nav-group">
              <a href ng-click="car_afetyController = !car_afetyController">
                Controller
              </a>
              <i ng-cloak ng-show="car_afetyController">+</i>
            </h2>
            <ul ng-hide="car_afetyController">
              <li>
                <a href="carSafety.adminpanelloginCtrl.html">adminpanelloginCtrl</a>
              </li><li>
                <a href="carSafety.adminpanelnavCtrl.html">adminpanelnavCtrl</a>
              </li><li>
                <a href="carSafety.apcompanyaddCtrl.html">apcompanyaddCtrl</a>
              </li><li>
                <a href="carSafety.apcompanyeditCtrl.html">apcompanyeditCtrl</a>
              </li><li>
                <a href="carSafety.apcompanylistCtrl.html">apcompanylistCtrl</a>
              </li><li>
                <a href="carSafety.apdeviceaddCtrl.html">apdeviceaddCtrl</a>
              </li><li>
                <a href="carSafety.apdeviceeditCtrl.html">apdeviceeditCtrl</a>
              </li><li>
                <a href="carSafety.apdevicelistCtrl.html">apdevicelistCtrl</a>
              </li><li>
                <a href="carSafety.apdrvcardaddCtrl.html">apdrvcardaddCtrl</a>
              </li><li>
                <a href="carSafety.apdrvcardlogCtrl.html">apdrvcardlogCtrl</a>
              </li><li>
                <a href="carSafety.apmailnotifyaddCtrl.html">apmailnotifyaddCtrl</a>
              </li><li>
                <a href="carSafety.apmailnotifyeditCtrl.html">apmailnotifyeditCtrl</a>
              </li><li>
                <a href="carSafety.apmailnotifylistCtrl.html">apmailnotifylistCtrl</a>
              </li><li>
                <a href="carSafety.autologinCtrl.html">autologinCtrl</a>
              </li><li>
                <a href="carSafety.companyProfileCtrl.html">companyProfileCtrl</a>
              </li><li>
                <a href="carSafety.404Ctrl.html">404Ctrl</a>
              </li><li>
                <a href="carSafety.dashCtrl.html">dashCtrl</a>
              </li><li>
                <a href="carSafety.deviceSetCtrl.html">deviceSetCtrl</a>
              </li><li>
                <a href="carSafety.drivergrpProfileCtrl.html">drivergrpProfileCtrl</a>
              </li><li>
                <a href="carSafety.drivergrpSetCtrl.html">drivergrpSetCtrl</a>
              </li><li>
                <a href="carSafety.driverProfileCtrl.html">driverProfileCtrl</a>
              </li><li>
                <a href="carSafety.driverSetCtrl.html">driverSetCtrl</a>
              </li><li>
                <a href="carSafety.forgetPwdCtrl.html">forgetPwdCtrl</a>
              </li><li>
                <a href="carSafety.helpCtrl.html">helpCtrl</a>
              </li><li>
                <a href="carSafety.liveLocationCtrl.html">liveLocationCtrl</a>
              </li><li>
                <a href="carSafety.liveMonitorCtrl.html">liveMonitorCtrl</a>
              </li><li>
                <a href="carSafety.loginCtrl.html">loginCtrl</a>
              </li><li>
                <a href="carSafety.mailNotifySetCtrl.html">mailNotifySetCtrl</a>
              </li><li>
                <a href="carSafety.orgchartSetCtrl.html">orgchartSetCtrl</a>
              </li><li>
                <a href="carSafety.resetPwdCtrl.html">resetPwdCtrl</a>
              </li><li>
                <a href="carSafety.rosterSetCtrl.html">rosterSetCtrl</a>
              </li><li>
                <a href="carSafety.tripDetailCtrl.html">tripDetailCtrl</a>
              </li><li>
                <a href="carSafety.tripDrvImportCtrl.html">tripDrvImportCtrl</a>
              </li><li>
                <a href="carSafety.tripSetCtrl.html">tripSetCtrl</a>
              </li><li>
                <a href="carSafety.updatePwdCtrl.html">updatePwdCtrl</a>
              </li><li>
                <a href="carSafety.userroleSetCtrl.html">userroleSetCtrl</a>
              </li><li>
                <a href="carSafety.userSetCtrl.html">userSetCtrl</a>
              </li><li>
                <a href="carSafety.vehiclegrpProfileCtrl.html">vehiclegrpProfileCtrl</a>
              </li><li>
                <a href="carSafety.vehiclegrpSetCtrl.html">vehiclegrpSetCtrl</a>
              </li><li>
                <a href="carSafety.vehicleProfileCtrl.html">vehicleProfileCtrl</a>
              </li><li>
                <a href="carSafety.vehicleSetCtrl.html">vehicleSetCtrl</a>
              </li><li>
                <a href="carSafety.warnExportCtrl.html">warnExportCtrl</a>
              </li><li>
                <a href="carSafety.warnvideoDownloadCtrl.html">warnvideoDownloadCtrl</a>
              </li>
            </ul>
          </ul><ul class="group">
            <h2 class="nav-group">
              <a href ng-click="car_afetyService = !car_afetyService">
                Service
              </a>
              <i ng-cloak ng-show="car_afetyService">+</i>
            </h2>
            <ul ng-hide="car_afetyService">
              <li>
                <a href="carSafety.alertBox.html">alertBox</a>
              </li><li>
                <a href="carSafety.formValidService.html">formValidService</a>
              </li><li>
                <a href="carSafety.httpSuccessCheck.html">httpSuccessCheck</a>
              </li><li>
                <a href="carSafety.langService.html">langService</a>
              </li><li>
                <a href="carSafety.profileService.html">profileService</a>
              </li><li>
                <a href="carSafety.refetchMapService.html">refetchMapService</a>
              </li><li>
                <a href="carSafety.responsiveCheck.html">responsiveCheck</a>
              </li>
            </ul>
          </ul><ul class="group">
            <h2 class="nav-group">
              <a href ng-click="car_afetyConfig = !car_afetyConfig">
                Config
              </a>
              <i ng-cloak ng-show="car_afetyConfig">+</i>
            </h2>
            <ul ng-hide="car_afetyConfig">
              <li>
                <a href="carSafety.angular-chart-js.html">angular-chart-js</a>
              </li><li>
                <a href="carSafety.angular-dynamic-locale.html">angular-dynamic-locale</a>
              </li><li>
                <a href="carSafety.angular-translate.html">angular-translate</a>
              </li><li>
                <a href="carSafety.angularjs.html">angularjs</a>
              </li><li>
                <a href="carSafety.angularjs-material.html">angularjs-material</a>
              </li><li>
                <a href="carSafety.block-ui.html">block-ui</a>
              </li><li>
                <a href="carSafety.ng-idle.html">ng-idle</a>
              </li><li>
                <a href="carSafety.state-transition.html">state-transition</a>
              </li><li>
                <a href="carSafety.ui-router.html">ui-router</a>
              </li>
            </ul>
          </ul><ul class="group">
            <h2 class="nav-group">
              <a href ng-click="car_afetyConstant = !car_afetyConstant">
                Constant
              </a>
              <i ng-cloak ng-show="car_afetyConstant">+</i>
            </h2>
            <ul ng-hide="car_afetyConstant">
              <li>
                <a href="carSafety.appConfig.html">appConfig</a>
              </li><li>
                <a href="carSafety.chartConfig.html">chartConfig</a>
              </li><li>
                <a href="carSafety.errorCodeConfig.html">errorCodeConfig</a>
              </li><li>
                <a href="carSafety.exportConfig.html">exportConfig</a>
              </li><li>
                <a href="carSafety.mapConfig.html">mapConfig</a>
              </li><li>
                <a href="carSafety.regexConfig.html">regexConfig</a>
              </li>
            </ul>
          </ul><ul class="group">
            <h2 class="nav-group">
              <a href ng-click="car_afetyDirective = !car_afetyDirective">
                Directive
              </a>
              <i ng-cloak ng-show="car_afetyDirective">+</i>
            </h2>
            <ul ng-hide="car_afetyDirective">
              <li>
                <a href="carSafety.bInfoWindow.html">bInfoWindow</a>
              </li><li>
                <a href="carSafety.bMarker.html">bMarker</a>
              </li><li>
                <a href="carSafety.bPolyline.html">bPolyline</a>
              </li><li>
                <a href="carSafety.bTrafficLayer.html">bTrafficLayer</a>
              </li><li>
                <a href="carSafety.convertToNumber.html">convertToNumber</a>
              </li><li>
                <a href="carSafety.customOnChange.html">customOnChange</a>
              </li><li>
                <a href="carSafety.fileInputImg.html">fileInputImg</a>
              </li><li>
                <a href="carSafety.multicheckListbox.html">multicheckListbox</a>
              </li><li>
                <a href="carSafety.navbar.html">navbar</a>
              </li><li>
                <a href="carSafety.pageSelect.html">pageSelect</a>
              </li><li>
                <a href="carSafety.showTooltipOnTextOverflow.html">showTooltipOnTextOverflow</a>
              </li><li>
                <a href="carSafety.stFiltered.html">stFiltered</a>
              </li><li>
                <a href="carSafety.stPersist.html">stPersist</a>
              </li><li>
                <a href="carSafety.stSelectDistinct.html">stSelectDistinct</a>
              </li><li>
                <a href="carSafety.virtualResize.html">virtualResize</a>
              </li>
            </ul>
          </ul><ul class="group">
            <h2 class="nav-group">
              <a href ng-click="car_afetyFilter = !car_afetyFilter">
                Filter
              </a>
              <i ng-cloak ng-show="car_afetyFilter">+</i>
            </h2>
            <ul ng-hide="car_afetyFilter">
              <li>
                <a href="carSafety.fixNum.html">fixNum</a>
              </li><li>
                <a href="carSafety.optionalFilter.html">optionalFilter</a>
              </li><li>
                <a href="carSafety.tableCustomFilter.html">tableCustomFilter</a>
              </li>
            </ul>
          </ul><ul class="group">
            <h2 class="nav-group">
              <a href ng-click="car_afetyRun = !car_afetyRun">
                Run
              </a>
              <i ng-cloak ng-show="car_afetyRun">+</i>
            </h2>
            <ul ng-hide="car_afetyRun">
              <li>
                <a href="carSafety.state-transition-init.html">state-transition-init</a>
              </li>
            </ul>
          </ul>
        </li>
      </ul>
      </div>
    </nav>
    <div id="content" class="page-wrap">
      <h1 class="title">
        source : orgchartSetCtrl.js
      </h1>
      <div id="main" class="big-container">
        <!-- source code html -->
        <article>
          <pre class="prettyprint source linenums"><code>/*
* @Author: Zilvia Kam
* @Date:   2019-04-04 17:39:30
* @Last Modified by:   Zilvia Kam
* @Last Modified time: 2019-10-08 11:24:51
*/
/**
 * @memberof carSafety
 * @ngdoc Controller
 * @name orgchartSetCtrl
 * @requires $scope,$state,$stateParams,$http,blockUI,$timeout,$translate,langService,$document,$window,$mdDialog,formValidService,tmhDynamicLocale,user,Idle,Keepalive,httpSuccessCheck,alertBox,$compile,$filter,refetchMapService
 * @description
 *   Controller for organization chart maintenance page.
 */
angular.module('carSafety').controller("orgchartSetCtrl",["$scope","$state","$stateParams","$http","blockUI","$timeout","$translate","langService","$document","$window","$mdDialog","formValidService","tmhDynamicLocale","user", "Idle", "Keepalive", "httpSuccessCheck", "alertBox", "$compile", "$filter", "refetchMapService", function($scope, $state, $stateParams, $http, blockUI, $timeout, $translate, langService,$document,$window,$mdDialog,formValidService,tmhDynamicLocale,user, Idle, Keepalive, httpSuccessCheck, alertBox, $compile, $filter, refetchMapService){
	Idle.watch();
	var blockUi = angular.element(document.getElementsByTagName("BODY")[0]);
	$scope.permission = user.func_code;
	$scope.userInfo = user;
	$scope.lang = $scope.userInfo.lang;
	window.document.title = $translate.instant('orgchartSet');
	$scope.updatelang = function(){
		var postData = {
            lang: $scope.lang
        }
		$http({
            method: 'POST',
            url: '/api/updateLang',
            data: postData
        }).then(function successCallback(response) {
        	blockUi.removeClass('block-ui-active block-ui-visible')
        	var errorphp = httpSuccessCheck.checkHttp(response)
			if(errorphp){
				alertBox.errorAlert('90006_01')
				$scope.lang = $scope.userInfo.lang;
			}
			else{
                if($scope.userInfo.map=='googleMap'){
                    refetchMapService.deleteGoogle()
                }
            	$state.reload()
            }
        }, function errorCallback(response) {
        	blockUi.removeClass('block-ui-active block-ui-visible')
			var errorphp = httpSuccessCheck.checkerrorHttp(response)
            if(errorphp){
                alertBox.errorAlert('90006_'+errorphp)
            }
            else{
                alertBox.errorAlert(response.data.code)
            }
            $scope.lang = $scope.userInfo.lang;
        });
	}
    $scope.$on('IdleStart', function () {
        alertBox.idleAlert()
    })
    $scope.$on('IdleEnd', function () {
        swal.close(function(){
            clearInterval(timerInterval)
        })
    })
    $scope.$on('IdleTimeout', function () {
        if(angular.element(document.body).hasClass('md-dialog-is-showing')){
            $mdDialog.cancel()
        }
        swal.close(function(){
            clearInterval(timerInterval)
        })
        var func = function(result){
            $state.go('login', {}, { reload: true })
        }
        $http({
            method: 'GET',
            url: '/api/logout'
        }).then(function successCallback(response) {
        	blockUi.removeClass('block-ui-active block-ui-visible')
            alertBox.timeoutAlert(func)
        }, function errorCallback(response) {
        	blockUi.removeClass('block-ui-active block-ui-visible')
            alertBox.timeoutAlert(func)
        });
    })
    $scope.nodeTemplate = function(data) {
        var html = "&lt;div class=\"title\">&lt;/div>&lt;div class=\"content\">&lt;p class=\"groupname\" ng-click=\"showFunc(\'"+data.id+"\')\">"+data.department+"&lt;/p>&lt;div ng-if=\""+data.showFunc+"\">&lt;p class=\"detail titletext\">{{\"departmentdescpt\"|translate}}:&lt;/p>&lt;p class=\"detail\">"+data.descpt+"&lt;/p>&lt;p class=\"detail titletext\">{{\"lastUpdateBy\"|translate}}:&lt;/p>&lt;p class=\"detail\">"+data.updated_by+"&lt;/p>&lt;hr>&lt;button type=\"button\" class=\"btn btn-success btn-sm\" ng-click=\"addeditItem($event,\'add\',\'"+data.id+"\')\">&lt;i class=\"fa fa-plus-circle\" aria-hidden=\"true\">&lt;/i>&lt;/button>&lt;button type=\"button\" class=\"btn btn-primary btn-sm\" ng-click=\"addeditItem($event,\'edit\',\'"+data.id+"\')\">&lt;i class=\"fa fa-pencil-square-o\" aria-hidden=\"true\">&lt;/i>&lt;/button>&lt;button type=\"button\" class=\"btn btn-danger btn-sm right\" ng-click=\"removeItem(\'"+data.id+"\')\" ng-if=\"userInfo.ou_id!==\'"+data.id+"\'\">&lt;i class=\"fa fa-trash\" aria-hidden=\"true\">&lt;/i>&lt;/button>&lt;/div>&lt;/div>"
        var template = angular.element(html);
        var element = $compile(template)($scope)
        return element;
    };
    $scope.orgchart = $('#chart-container').orgchart({
        'data': {},
        'nodeTemplate': $scope.nodeTemplate,
        'chartClass': 'orgchart-custom',
        'toggleSiblingsResp': true
    });
    $scope.refreshList = function(){
        $http({
            method: 'GET',
            url: '/api/orgchartSet'
        }).then(function successCallback(response) {
            var errorphp = httpSuccessCheck.checkHttp(response)
            if(errorphp){
                blockUi.removeClass('block-ui-active block-ui-visible')
                alertBox.errorAlert('91702_01')
            }
            else{
                if(response.data.data[0]){
                    $scope.datasource = response.data.data[0]
                }
                else{
                    $scope.datasource = response.data.data
                }
                $scope.orgchart.init({'data':$scope.datasource})
                $scope.filterChart()
                blockUi.removeClass('block-ui-active block-ui-visible')
            }
        }, function errorCallback(response) {
            blockUi.removeClass('block-ui-active block-ui-visible')
            var errorphp = httpSuccessCheck.checkerrorHttp(response)
            if(errorphp){
                alertBox.errorAlert('91702_'+errorphp)
            }
            else{
                alertBox.errorAlert(response.data.code)
            }
        });
    }
    $scope.refreshList()
    $scope.exportOrgchart = function(){
        var exportFilename = $translate.instant('orgChart')
        $scope.orgchart.export(exportFilename)
    }
    $scope.removeItem = function removeItem(id) {
        swal({
            title: $translate.instant('delete_item'),
            type: 'question',
            target: document.getElementsByTagName('BODY')[0],
            showCancelButton: true,
            confirmButtonText: $translate.instant('ok'),
            cancelButtonText: $translate.instant('cancel'),
            allowOutsideClick: false,
            allowEscapeKey: false,
            allowEnterKey: false
        })
        .then(function(result){
            if (result.value) {
                var postData = {
                    id: id
                }
                $http({
                    method: 'DELETE',
                    url: '/api/orgchartSet',
                    data: postData,
                    headers: {
                        'Content-type': 'application/json;charset=utf-8'
                    }
                }).then(function successCallback(response) {
                    blockUi.removeClass('block-ui-active block-ui-visible')
                    var errorphp = httpSuccessCheck.checkHttp(response)
                    if(errorphp){
                        alertBox.errorAlert('91705_01')
                    }
                    else{
                        alertBox.titleAlert('success','deleteSuccess')
                        $scope.refreshList()
                    }
                }, function errorCallback(response) {
                    blockUi.removeClass('block-ui-active block-ui-visible')
                    var errorphp = httpSuccessCheck.checkerrorHttp(response)
                    if(errorphp){
                        alertBox.errorAlert('91705_'+errorphp)
                    }
                    else{
                        alertBox.errorAlert(response.data.code)
                    }
                });
            }
        })
    }
    $scope.filterChart = function(){
        var chart = $('.orgchart');
        chart.removeClass('noncollapsable')
        chart.find('.node').removeClass('matched retained')
        .end().find('.hidden').removeClass('hidden')
        .end().find('.slide-down, .slide-up, .slide-left, .slide-right').removeClass('slide-down slide-up slide-right slide-left');
        if($scope.filter){
            chart.addClass('noncollapsable');
            chart.find('.node').filter(function(index, node) {
                return $(node).text().toLowerCase().indexOf($scope.filter.toLowerCase()) > -1;
            })
            .addClass('matched')
            .closest('table').parents('table').find('tr:first').find('.node').addClass('retained');
            chart.find('.matched,.retained').each(function(index, node) {
                $(node).removeClass('slide-up')
                .closest('.nodes').removeClass('hidden')
                .siblings('.lines').removeClass('hidden');
                var unmatched = $(node).closest('table').parent().siblings().find('.node:first:not(.matched,.retained)')
                .closest('table').parent().addClass('hidden');
                unmatched.parent().prev().children().slice(1, unmatched.length * 2 + 1).addClass('hidden');
            });
            /*chart.find('.matched').each(function(index, node) {
                if (!$(node).closest('tr').siblings(':last').find('.matched').length) {
                  $(node).closest('tr').siblings().addClass('hidden');
                }
            });*/
            if(chart.find('.matched,.retained').length==0){
                chart.find('.node').each(function(index, node) {
                    $(node).closest('tr').addClass('hidden');
                    $(node).closest('tr').siblings().addClass('hidden');
                });
            }
        }
    }
    $scope.redraw = function(object,str) {
        Object.keys(object).forEach(function (k) {
            if(object[k] && typeof object[k] === 'object'){
                return $scope.redraw(object[k], str)
            }
            else{
                if(k=='id'&&object[k]==str){
                    object['showFunc'] = !object['showFunc']
                }
            }
        });
    }
    $scope.find = function(obj, id) {
        var result;
        for (var p in obj) {
            if (obj.id == id) {
                return obj;
            } else {
                if (typeof obj[p] == 'object') {
                    result = $scope.find(obj[p], id);
                    if (result) {
                        return result;
                    }
                }
            }
        }
        return result;
    }
    $scope.funcClick = {
        id: null,
        time: null
    }
    $scope.showFunc = function(str){
        var tmp = angular.copy($scope.datasource)
        if($scope.funcClick.id!==str){
            $scope.funcClick.id = str;
            $scope.funcClick.time = 1;
            $scope.redraw(tmp,str)
        }
        else{
            $scope.funcClick.time += 1;
            if($scope.funcClick.time%2!==0){
                $scope.redraw(tmp,str)
            }
        }
        $scope.orgchart.init({'data':tmp})
        $scope.filterChart()
    }
    $timeout(function () {
        var table = document.getElementsByClassName('orgchart-container')[0]
        var headerHeight = document.getElementsByClassName('orgchart-content-header')[0].clientHeight
        table.style.minHeight = 'calc( 100% - '+headerHeight+'px )'
    })
    angular.element($window).bind('resize', function () {
        var table = document.getElementsByClassName('orgchart-container')[0]
        var headerHeight = document.getElementsByClassName('orgchart-content-header')[0].clientHeight
        table.style.minHeight = 'calc( 100% - '+headerHeight+'px )'
    })
    $scope.$on('$destroy', function(){
        if(angular.element(document.body).hasClass('md-dialog-is-showing')){
            $mdDialog.cancel()
        }
        angular.element($window).unbind('resize')
    })
    $scope.addeditItem = function(ev,action,row) {
        if(row){
            row = $scope.find($scope.datasource,row)
        }
        if(action=='edit'){
            $http({
                method: 'GET',
                url: '/api/orgchartAddL/'+row.id
            }).then(function successCallback(response) {
                blockUi.removeClass('block-ui-active block-ui-visible')
                var errorphp = httpSuccessCheck.checkHttp(response)
                if(errorphp){
                    alertBox.errorAlert('91701_01')
                }
                else{
                    var dialogparentlist = response.data.data
                    $mdDialog.show({
                        controller: DialogController,
                        templateUrl: '/view/component/dialog/orgchartSetDialog.html',
                        parent: angular.element(document.querySelector('.orgchart-wrap')),
                        targetEvent: ev,
                        locals: {
                            action: action,
                            row: angular.copy(row),
                            parentList: angular.copy(dialogparentlist),
                            rootnode: $scope.userInfo.ou_id,
                        },
                        clickOutsideToClose: false,
                        escapeToClose: false,
                        focusOnOpen: false,
                        //hasBackdrop:false,
                        disableParentScroll: true,
                        fullscreen: true // Only for -xs, -sm breakpoints.
                    })
                    .then(function(answer) {
                        alertBox.titleAlert('success',answer)
                        $scope.refreshList()
                    }, function() {
                    });
                }
            }, function errorCallback(response) {
                blockUi.removeClass('block-ui-active block-ui-visible')
                var errorphp = httpSuccessCheck.checkerrorHttp(response)
                if(errorphp){
                    alertBox.errorAlert('91701_'+errorphp)
                }
                else{
                    alertBox.errorAlert(response.data.code)
                }
            });
        }
        else{
            $mdDialog.show({
                controller: DialogController,
                templateUrl: '/view/component/dialog/orgchartSetDialog.html',
                parent: angular.element(document.querySelector('.orgchart-wrap')),
                targetEvent: ev,
                locals: {
                    action: action,
                    row: angular.copy(row),
                    parentList: [],
                    rootnode: $scope.userInfo.ou_id,
                },
                clickOutsideToClose: false,
                escapeToClose: false,
                focusOnOpen: false,
                //hasBackdrop:false,
                disableParentScroll: true,
                fullscreen: true // Only for -xs, -sm breakpoints.
            })
            .then(function(answer) {
                alertBox.titleAlert('success',answer)
                $scope.refreshList()
            }, function() {
            });
        }
    };
    function DialogController($scope, $mdDialog, $window, action, row, parentList, formValidService, rootnode) {
        var html = document.getElementsByTagName('HTML')[0]
        var blockUi = angular.element(document.getElementsByTagName("BODY")[0]);
        $timeout(function(){
            html.style.removeProperty('overflow-y')
        })
        $scope.action = action;
        $scope.root = rootnode;
        $timeout(function () {
            var body = document.getElementsByTagName('body')[0]
            body.style.position='fixed'
            //body.style.top=0+'px'
            body.style.width=100+'%'
        })
        $scope.$watch(function () {
            if(document.getElementsByClassName('set-dialog-wrap')[0]){
                return document.getElementsByClassName('set-dialog-wrap')[0].scrollTop;
            }
            else{
                return false;
            }
        },
        function (newValue, oldValue) {
            if (newValue!==0&&newValue!==false){
                document.getElementsByClassName('set-dialog-wrap')[0].scrollTop=0;
            }
        })
        $scope.parentList = parentList;
        if($scope.action=='add'){
            $scope.row={
                department: "",
                descpt: "",
                parentData: {parent_id:row.id,parent_descpt:row.department}
            }
        }
        else{
            $scope.row=row
            if(!$scope.row.parentData.parent_descpt){
                $scope.row.parentData=undefined
            }
        }
        if($scope.action=='edit'){
            var dataArr
            if($scope.root==$scope.row.id){
                dataArr = ['department','departmentdescpt']
            }
            else{
                dataArr = ['department','departmentdescpt','parentTAH']
            }
            $timeout(function () {
                for(var i=0;i&lt;dataArr.length;i++){
                    var validate = document.getElementsByName(dataArr[i])[0]
                    if(dataArr[i].indexOf('TAH')!==-1){
                        formValidService.setValidTAH(validate)
                    }
                    else if(dataArr[i].indexOf('IPG')!==-1){
                        formValidService.setValidIPG(validate)
                    }
                    else{
                        formValidService.setValid(validate)
                    }
                }
            })
        }
        else{
            var dataArr = ['department']
        }
        $scope.hide = function() {
          $mdDialog.hide();
        };
        $scope.cancel = function() {
          $mdDialog.cancel();
        };
        $scope.submit = function(answer) {
            var parent_id=null
            if(answer.parentData!==undefined){
                parent_id = answer.parentData.parent_id
            }
            if($scope.action=='add'){
                var postData = {
                    department: answer.department,
                    descpt: answer.descpt,
                    parent_id: parent_id
                }
                $http({
                    method: 'POST',
                    url: '/api/orgchartSet',
                    data: postData
                }).then(function successCallback(response) {
                    blockUi.removeClass('block-ui-active block-ui-visible')
                    var errorphp = httpSuccessCheck.checkHttp(response)
                    if(errorphp){
                        alertBox.errorAlert('91703_01')
                    }
                    else{
                        $mdDialog.hide('addSuccess');
                    }
                }, function errorCallback(response) {
                    blockUi.removeClass('block-ui-active block-ui-visible')
                    var errorphp = httpSuccessCheck.checkerrorHttp(response)
                    if(errorphp){
                        alertBox.errorAlert('91703_'+errorphp)
                    }
                    else{
                        alertBox.errorAlert(response.data.code)
                    }
                });
            }
            else{
                var postData = {
                    id: answer.id,
                    department: answer.department,
                    descpt: answer.descpt,
                    parent_id: parent_id,
                    version: answer.version
                }
                $http({
                    method: 'PATCH',
                    url: '/api/orgchartSet',
                    data: postData
                }).then(function successCallback(response) {
                    blockUi.removeClass('block-ui-active block-ui-visible')
                    var errorphp = httpSuccessCheck.checkHttp(response)
                    if(errorphp){
                        alertBox.errorAlert('91704_01')
                    }
                    else{
                        $mdDialog.hide('editSuccess');
                    }
                }, function errorCallback(response) {
                    blockUi.removeClass('block-ui-active block-ui-visible')
                    var errorphp = httpSuccessCheck.checkerrorHttp(response)
                    if(errorphp){
                        alertBox.errorAlert('91704_'+errorphp)
                    }
                    else{
                        alertBox.errorAlert(response.data.code)
                    }
                });
            }
        };
        $scope.typeaheadscroll = function(){
            $timeout(function () {
                if(document.querySelector('.md-virtual-repeat-sizer').clientHeight&lt;80){
                    document.querySelector('.md-virtual-repeat-offsetter').style.transform = "translateY(0)"
                }
            })
        }
        $scope.validate = function(formstr){
            $timeout(function () {
                var validate = document.getElementsByName(formstr)[0]
                var invalidFunc
                var validFunc
                var validMatch
                var tahValidModel
                if(formstr.indexOf('Match')!==-1){
                    validMatch = formstr.split("Match")[0]+'Confirm'
                }
                if(formstr.indexOf('TAH')!==-1){
                    validate = document.getElementsByName(formstr)[1]
                    tahValidModel = formstr.split("TAH")[0]
                    invalidFunc = 'setInvalidTAH'
                    validFunc = 'setValidTAH'
                }
                else if(formstr.indexOf('IPG')!==-1){
                    invalidFunc = 'setInvalidIPG'
                    validFunc = 'setValidIPG'
                }
                else{
                    invalidFunc = 'setInvalid'
                    validFunc = 'setValid'
                }
                if(validate){
                    if(formstr.indexOf('TAH')!==-1){
                        if($scope.addEdit[formstr].$invalid){
                            formValidService[invalidFunc](validate)
                        }
                        else{
                            if($scope.row[tahValidModel]){
                                if($scope['noResults'+formstr]){
                                formValidService[invalidFunc](validate)
                                }
                                else{
                                    formValidService[validFunc](validate)
                                }
                            }
                            else{
                                formValidService[validFunc](validate)
                            }
                        }
                    }
                    else if($scope.addEdit[formstr].$invalid){
                        formValidService[invalidFunc](validate)
                    }
                    else{
                        formValidService[validFunc](validate)
                    }
                }
                if(validMatch){
                    $scope.validate(validMatch)
                }
            })
        }
        $scope.validateSelect = function(formstr){
            var validate = document.getElementsByName(formstr)[0]
            formValidService.setValidTAH(validate)
        }
        $scope.validateForm = function(){
            $scope.attempt = true;
            for(var i=0;i&lt;dataArr.length;i++){
                var validate = document.getElementsByName(dataArr[i])[0]
                if(!$scope.addEdit[dataArr[i]].$touched){
                    if(dataArr[i].indexOf('TAH')!==-1){
                        formValidService.setValidTAH(validate)
                    }
                    else if(dataArr[i].indexOf('IPG')!==-1){
                        formValidService.setInvalidIPG(validate)
                    }
                    else{
                        formValidService.setValid(validate)
                    }
                }
            }
        }
    }
    DialogController.$inject = ["$scope", "$mdDialog", "$window", "action", "row", "parentList", "formValidService", "rootnode"];
}]);</code></pre>
        </article>
        <!-- index.html -->
        <!-- class files -->
      </div>
      <footer style="clear:both">
        Documentation generated by
        <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a>
        using
        <a href="https://github.com/allenhwkim/angular-jsdoc">Angular-JSDoc template</a>
      </footer>
    </div>
    <script src="js/prettify.js"></script>
    <script src="js/angular.min.js"></script>
    <script src="js/site.js"></script>
    <!--%= prettyJson %-->
    <script>
      prettyPrint();
      var lineNo = window.location.hash.match(/#line([0-9]+)$/);
      lineNo && document.querySelector("ol li:nth-child("+(lineNo[1])+")").scrollIntoView();
    </script>
  </body>
</html>